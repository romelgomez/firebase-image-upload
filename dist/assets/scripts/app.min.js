"use strict";angular.module("app",["angular-loading-bar","filters","validators","firebase","fire","routes","tree","publications","login","account","ui.bootstrap","main","angular-underscore","updateMeta"]).controller("AppController",["$scope","FireAuth",function(e,t){e.logout=function(){t.$unauth()},e.inProduction=!1,e.sizeOf=function(e){return"undefined"==typeof e&&(e={}),Object.keys(e).length},e.firstObj=function(e){for(var t in e)if(e.hasOwnProperty(t))return t}}]),angular.module("main",[]).controller("MainController",[function(e){}]).directive("inputFocus",[function(){return{restrict:"A",link:function(e,t){t.focus()}}}]),angular.module("filters",[]).filter("capitalize",[function(){return function(e){return e?e.replace(/([^\W_]+[^\s-]*) */g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}):""}}]).directive("capitalize",["$filter",function(e){return{require:"ngModel",link:function(t,a,o,i){i.$parsers.push(function(t){var a=e("capitalize")(t);return a!=t&&(i.$setViewValue(a),i.$render()),a})}}}]).filter("slug",[function(){return function(e){return e?String(e).toLowerCase().replace(/[^a-zá-źA-ZÁ-Ź0-9]/g," ").trim().replace(/\s{2,}/g," ").replace(/\s+/g,"-"):""}}]).filter("noSpecialChars",[function(){return function(e){return e?String(e).replace(/[^a-zá-źA-ZÁ-Ź0-9]/g," ").trim().replace(/\s{2,}/g," "):""}}]).filter("capitalizeFirstChar",[function(){return function(e){return e?e.trim().replace(/(^\w?)/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1)}):""}}]).directive("capitalizeFirstChar",["$filter",function(e){return{require:"ngModel",link:function(t,a,o,i){i.$parsers.push(function(t){var a=e("capitalizeFirstChar")(t);return a!=t&&(i.$setViewValue(a),i.$render()),a})}}}]).filter("dateParse",["$window","$filter",function(e,t){return function(a,o,i){return a?t("date")(e.Date.parse(a),o,i):""}}]).filter("stringReplace",[function(){return function(e,t,a){return e.split(t).join(a)}}]).filter("reverse",[function(){return function(e){return angular.isArray(e)?e.slice().reverse():[]}}]).filter("camelCase",[function(){return function(e){return e?e.trim().replace(/(?:^\w|[A-Z]|\b\w|\s+)/g,function(e,t){return 0===+e?"":0===t?e.toLowerCase():e.toUpperCase()}):""}}]).filter("lispCaseToCamelCase",[function(){return function(e){return e?e.trim().replace(/[\-_](\w)/g,function(e){return e.charAt(1).toUpperCase()}):""}}]).filter("bytes",[function(){return function(e,t){if(isNaN(parseFloat(e))||!isFinite(e))return"-";"undefined"==typeof t&&(t=1);var a=["bytes","kB","MB","GB","TB","PB"],o=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,Math.floor(o))).toFixed(t)+" "+a[o]}}]).filter("htmlToPlaintext",[function(){return function(e){return e?String(e).replace(/<[^>]+>/gm," ").trim():""}}]).filter("unsafe",["$sce",function(e){return e.trustAsHtml}]).filter("removeFileExtension",["$filter",function(e){return function(t){return t?e("stringReplace")(t,"."+t.split(".").pop(),"").trim():""}}]),angular.module("validators",[]).directive("noSpecialChars",function(){return{restrict:"A",require:"ngModel",link:function(e,t,a,o){o.$validators.noSpecialChars=function(e){return String(e).match(/[^a-zá-źA-ZÁ-Ź0-9\s]/g)?!1:!0}}}}),angular.module("fire",[]).constant("FIRE_BASE_URL","https://berlin.firebaseio.com").constant("SIMPLE_LOGIN_PROVIDERS",["password","facebook","google","twitter"]).constant("LOGIN_REDIRECT_PATH","/login").factory("FireAuth",["$firebaseAuth","FireRef",function(e,t){return e(t)}]).factory("FireRef",["$window","FIRE_BASE_URL",function(e,t){return new e.Firebase(t)}]).directive("ngHideAuth",["FireAuth","$timeout",function(e,t){return{restrict:"A",link:function(a,o){function i(){t(function(){o.toggleClass("ng-cloak",!!e.$getAuth())},0)}o.addClass("ng-cloak"),e.$onAuth(i),i()}}}]).directive("ngShowAuth",["FireAuth","$timeout",function(e,t){return{restrict:"A",link:function(a,o){function i(){t(function(){o.toggleClass("ng-cloak",!e.$getAuth())},0)}o.addClass("ng-cloak"),e.$onAuth(i),i()}}}]),angular.module("routes",["ngRoute"]).config(["$routeProvider","SECURED_ROUTES",function(e,t){e.whenAuthenticated=function(a,o){return o.resolve=o.resolve||{},o.resolve.user=["FireAuth",function(e){return e.$requireAuth()}],e.when(a,o),t[a]=!0,e}}]).config(["$routeProvider",function(e){e.when("/",{templateUrl:"assets/views/main.html",controller:"MainController"}).whenAuthenticated("/categories",{templateUrl:"assets/views/categories.html",controller:"TreeController"}).whenAuthenticated("/locations",{templateUrl:"assets/views/locations.html",controller:"TreeController"}).whenAuthenticated("/j-tree-test",{templateUrl:"assets/views/jtree-diretive-test.html",controller:"TreeController"}).whenAuthenticated("/new-publication",{templateUrl:"assets/views/publication.html",controller:"PublicationsController"}).whenAuthenticated("/edit-publication/:publicationId",{templateUrl:"assets/views/publication.html",controller:"PublicationsController"}).when("/view-publication/:publicationId/:title",{templateUrl:"assets/views/viewPublication.html",controller:"ViewPublicationController"}).when("/login",{templateUrl:"assets/views/login.html",controller:"LoginController"}).whenAuthenticated("/account",{templateUrl:"assets/views/account.html",controller:"AccountController"}).otherwise({redirectTo:"/"})}]).run(["$rootScope","$location","FireAuth","SECURED_ROUTES","LOGIN_REDIRECT_PATH",function(e,t,a,o,i){function r(e){!e&&n(t.path())&&t.path(i)}function n(e){return o.hasOwnProperty(e)}a.$onAuth(r),e.$on("$routeChangeError",function(e,a,o,r){"AUTH_REQUIRED"===r.toString()&&t.path(i)})}]).constant("SECURED_ROUTES",{}).constant("LOGIN_REDIRECT_PATH","/login"),angular.module("tree",["ngMessages","cgBusy","jlareau.pnotify"]).factory("treeService",["$filter",function(e){return{getPath:function(t,a){var o=[],i=e("reverse")(a),r=function(e){angular.forEach(i,function(t){e===t.$id&&(o.push(t),""!==t.parentId&&r(t.parentId))})};return r(t),e("reverse")(o)},pathNames:function(e){var t=[];return angular.forEach(e,function(e){t.push(e.name)}),t}}}]).controller("TreeController",["$scope","$location","user",function(e,t,a){"facebook:10204911533563856"!==a.uid&&t.path("/")}]).controller("EditNodeController",["$scope","$q","$modalInstance","node","nodeRef",function(e,t,a,o,i){function r(e){var a=t.defer(),o=a.promise;return i.update({name:e.name},function(e){e?a.reject(e):a.resolve()}),o}e.model={name:o.name,id:o.id},e.confirm=function(){e.editNodeForm.$valid&&(e.httpRequestPromise=r(e.model).then(function(){a.close()},function(e){a.dismiss(e)}))},e.cancel=function(){a.dismiss("The editing is been canceled")}}]).controller("DeleteNodeController",["$scope","$modalInstance","node",function(e,t,a){e.node=a,e.branchCheckBox=e.node.left+1!==e.node.right,e.model={branch:null},e.confirm=function(){t.close({node:a,branch:e.model.branch})},e.cancel=function(){t.dismiss("Delete action has be cancel")}}]).directive("jTree",["$q","$templateCache","$compile","$uibModal","FireRef","$firebaseArray","$firebaseObject","notificationService","$log",function(e,t,a,o,i,r,n,l,c){function s(t){var a=e.defer(),o=i.child($);return o.set(t,function(e){e?a.reject(e):a.resolve()}),a.promise}function d(e){var t={},a=function(e){angular.forEach(e,function(e){t[e.id]={},t[e.id].name=e.name,t[e.id].parentId=e.parentId,t[e.id].left=e.left,t[e.id].right=e.right,e.children.length>0&&a(e.children)})};return a(e),t}function u(e){var t,a=function(e,o){angular.forEach(e,function(e){t||(t=1),e.left=t,t+=1,o?e.parentId=o:e.parentId="",void 0!==e.children&&e.children.length>=1?a(e.children,e.id):e.children=[],e.right=t,t+=1})};a(e)}function m(e,t,a){var o={targetTree:[],recordsIdsForDelete:[]},i=function(e){var t=[];t.push(e.id);var a=function(e){angular.forEach(e,function(e){t.push(e.id),e.children.length>0&&a(e.children)})};return a(e.children),t},r=function(e){angular.forEach(e,function(e){if(e.id===t)if(e.children.length>0)if(a===!0)o.recordsIdsForDelete=i(e);else{if(o.recordsIdsForDelete.push(e.id),""===e.parentId)for(var n=0;n<e.children.length;n++)e.children[n].parentId="";else for(var l=0;l<e.children.length;l++)e.children[l].parentId=e.parentId;r(e.children)}else o.recordsIdsForDelete.push(e.id);else{var c={id:e.id,parentId:e.parentId,name:e.label,left:e.left,right:e.right,children:[]};""!==e.parentId?f(o.targetTree,c):o.targetTree.push(c),void 0!==e.children&&r(e.children)}})};return r(e),o}function p(e){var t={};return t.id=e.$id,t.label=e.name,t.parentId=e.parentId,t.left=parseInt(e.left),t.right=parseInt(e.right),t.children=[],t}function f(e,t){angular.forEach(e,function(e){e.id===t.parentId?e.children.push(t):e.children.length>0&&f(e.children,t)})}function g(e){var t=[];return angular.forEach(e,function(e){var a=p(e);""!==a.parentId?f(t,a):t.push(a)}),t}function h(e,t){var a={dragAndDrop:!0,selectable:!0,autoEscape:!1,autoOpen:!1,data:t};e.tree(a)}function b(e,t){e.tree("loadData",t)}var v={rawNodes:[]},y={},$="";return{restrict:"E",template:'<section cg-busy="{promise:httpRequestPromise,message:\'Just a moment\'}"><section><div class="panel panel-default"><div class="panel-heading"><h3 class="panel-title">New node</h3></div><div class="panel-body" ><form id="nodeForm" name="nodeForm" novalidate="" ng-submit="nodeFormSettings.submitForm()"><div class="form-group"><label>New node</label><input type="text" name="node" ng-model="nodeFormSettings.model.nodeName" required class="form-control" placeholder="" tabindex="1"><div data-ng-messages="nodeForm.$submitted && nodeForm.node.$error" class="help-block"><div data-ng-message="required">- The <b>node</b> name is required.</div><div data-ng-message="noSpecialChars">- The <b>node</b> name must not have special characters.</div></div></div></form></div><div class="panel-footer"><button form="nodeForm" class="btn btn-primary" type="submit">Send</button> <button class="btn btn-warning" ng-click="nodeFormSettings.resetForm()">Cancel</button></div></div></section><section><div class="panel panel-default"><div class="panel-heading"><h3 class="panel-title" style="line-height: 30px;">The <b>{{reference | capitalize}}</b> tree data:<div class="btn-group pull-right" role="group" aria-label="..." ng-show="nodeSelected.status"><button ng-click="editNode(nodeSelected.node)" type="button" class="btn btn-info">Edit</button><button ng-click="deleteNode(nodeSelected.node)" type="button" class="btn btn-danger">Delete</button></div></h3></div><div class="panel-body"><div ng-show="rawNodes.length === 0">Start add some data.</div><div id="tree"></div><div/><div/></section><section><div class="panel panel-default"><div class="panel-heading"><h3 class="panel-title" style="line-height: 30px;">The <b>{{reference | capitalize}}</b> tree <b>Raw</b> data: </h3></div><div class="panel-body"><div><div class="alert alert-danger" role="alert"> For recovering purposes, after any changes, update the node service at code level, to avoid lost of this critical data.  </div></div><pre>{{rawNodes | json }}</pre><div/><div/></section><section/>',scope:{reference:"@"},link:function(e,t){if("undefined"==typeof e.reference)throw">>> The reference attr is undefined >>>";$=e.reference;var a=t.find("#tree");h(a,[]),a.bind("tree.move",function(t){t.preventDefault(),t.move_info.do_move();var o=angular.fromJson(a.tree("toJson"));u(o);var i=d(o);e.httpRequestPromise=s(i).then(function(){e.nodeSelected={},l.success("The tree or nodes has been update")},function(e){l.error(e)})}),a.bind("tree.select",function(t){var a={status:!1,$node:{}};null!==t.node&&(a.node=t.node,a.status=!0),e.nodeSelected=a,y=a,e.$apply()}),e.editNode=function(t){var a=o.open({template:'<div class="modal-header"><h3 class="modal-title">Edit node:</h3></div><div class="modal-body" cg-busy="{promise:httpRequestPromise,message:\'Just a moment\'}"><h3 class="text-danger" style="margin-top: 0; margin-bottom: 0;">{{node.name | capitalizeFirstChar}}</h3><form id="editNodeForm" name="editNodeForm" novalidate="" ng-submit="confirm()"><div class="form-group"><label>Node name</label><input type="text" name="node" ng-model="model.name" required no-special-chars class="form-control" placeholder="" tabindex="1"><div data-ng-messages="editNodeForm.$submitted && editNodeForm.node.$error" class="help-block"><div data-ng-message="required">- The <b>node</b> name is required.</div><div data-ng-message="noSpecialChars">- La <b>node</b> name must not have special characters.</div></div></div></form></div><div class="modal-footer"><button class="btn btn-warning" ng-click="cancel()">Cancel</button><button form="editNodeForm" class="btn btn-primary" type="submit">Confirm</button></div>',controller:"EditNodeController",resolve:{node:function(){return t},nodeRef:function(){return i.child(e.reference).child(t.id)}}});a.result.then(function(){e.nodeSelected={},l.success("It was updated successfully.")},function(e){l.error(e)})},e.deleteNode=function(t){var a=o.open({template:'<div class="modal-header"><h3 class="modal-title">Do you really want to delete this node?</h3></div><div class="modal-body"><h3 class="text-danger" style="margin-top: 0; margin-bottom: 0;">{{node.name | capitalizeFirstChar}}</h3><form id="deleteBranchForm" name="deleteBranchForm" novalidate="" ng-submit="confirm()"><div ng-show="branchCheckBox"><div class="checkbox"><label><input type="checkbox" name="branch" ng-model="model.branch" value="">And daughters nodes to.</label></div></div></form></div><div class="modal-footer"><button class="btn btn-warning" ng-click="cancel()">Cancel</button><button form="deleteBranchForm" class="btn btn-primary" type="submit">Confirm</button></div>',controller:"DeleteNodeController",resolve:{node:function(){return t}}});a.result.then(function(t){e.nodeSelected={};var a=m(g(v.rawNodes),t.node.id,t.branch);u(a.targetTree);var o=d(a.targetTree);e.httpRequestPromise=s(o).then(function(){l.success("The tree or nodes has been update")},function(e){l.error(e)})},function(e){l.error(e)})},e.nodeFormSettings={model:{nodeName:""},submitForm:function(){if(e.nodeForm.$valid){var t,a,o=v.rawNodes.length;if(o>=1){var i=2*o;t=i+1,a=i+2}else t=1,a=2;var r={left:t,right:a,parentId:"",name:e.nodeFormSettings.model.nodeName};e.httpRequestPromise=v.rawNodes.$add(r).then(function(){e.nodeSelected={},l.success("Data has been saved."),e.nodeFormSettings.resetForm()},function(e){l.error(e)})}},resetForm:function(){e.nodeFormSettings.model=angular.copy(e.nodeFormSettings.modelCopy),e.nodeForm.$setUntouched(),e.nodeForm.$setPristine()}},e.nodeFormSettings.modelCopy=angular.copy(e.nodeFormSettings.model),v.rawNodes=r(i.child(e.reference).orderByChild("left")),e.rawNodes=n(i.child(e.reference).orderByChild("left")),e.httpRequestPromise=v.rawNodes.$loaded(null,function(e){l.error(e)}),v.rawNodes.$watch(function(){b(a,g(v.rawNodes))})}}}]);var publicationsModule=angular.module("publications",["uuid","ngMessages","angular-redactor","ngFileUpload","cloudinary","algoliasearch"]).factory("publicationService",["$q","$window","imagesService",function(e,t,a){return{savePublication:function(a,o,i){var r=e.defer();if(angular.isDefined(i)&&""!==i){var n=o.child(i);delete a.releaseDate,delete a.images,n.update(a,function(e){e?r.reject(e):r.resolve({publicationId:i})})}else{var l=o.push();a.releaseDate=t.Firebase.ServerValue.TIMESTAMP,l.set(a,function(e){e?r.reject(e):r.resolve({publicationId:l.key()})})}return r.promise},removePublication:function(t,o){var i=e.defer(),r={};return r.deleteImages=a.deleteImages(o,null),r.detelePublication=t.child(o).remove(function(e){e?i.reject(e):i.resolve()}),e.all(r).then(function(){i.resolve()},function(e){notificationService.error(e)}),i.promise}}}]).controller("PublicationsController",["$scope","$q","$window","$filter","$routeParams","$location","$http","FireRef","$firebaseArray","$firebaseObject","rfc4122","treeService","notificationService","Upload","user","$uibModal","publicationService","imagesService","$log",function(e,t,a,o,i,r,n,l,c,s,d,u,m,p,f,g,h,b,v){function y(e){var a=t.defer(),o=I.child(e),i=s(o);return i.$loaded(function(){"undefined"==typeof i.releaseDate?a.reject("404"):f.uid!==i.userID?a.reject("401"):a.resolve({publication:i})},function(e){a.reject(e)}),a.promise}function $(a){var o=t.defer();return y(a).then(function(t){angular.forEach(t.publication,function(t,a){"releaseDate"!==a&&(e.publication.model[a]=t)})}).then(function(){e.publication.images=[],angular.forEach(e.publication.model.images,function(t,a){t.$id=a,e.publication.images.push(t)})}).then(function(){e.publication.$id=a,e.publication.categoryPath=u.getPath(e.publication.model.categoryId,e.publication.categories),e.publication.categoryPath.length>0?e.publication.categorySelected=!0:(e.publication.redefineCategory=!0,e.publication.categorySelected=!1,e.publication.model.categoryId=""),e.publication.locationPath=u.getPath(e.publication.model.locationId,e.publication.locations),0===e.publication.locationPath.length&&(e.publication.redefineLocation=!0,e.publication.model.locationId=""),e.publication.inEditMode=!0,o.resolve()},function(e){r.path("/"),o.reject(e)}),o.promise}var w=t.defer(),I=l.child("publications");e.httpRequestPromise=w.promise,e.publication={$id:"",categoryPath:[],locationPath:[],categories:c(l.child("categories").orderByChild("left")),locations:c(l.child("locations").orderByChild("left")),categorySelected:!1,inEditMode:!1,isReady:!1,model:{userID:f.uid,categoryId:"",locationId:"",featuredImageId:"",department:"",title:"",htmlDescription:"",barcode:"",barcodeType:"CODE128"}};var S=e.publication.categories.$loaded(),P=e.publication.locations.$loaded();t.all([S,P]).then(function(){return angular.isDefined(i.publicationId)?$(i.publicationId):void(e.publication.images=[])}).then(function(){e.publication.isReady=!0,w.resolve()}),e.submit=function(){if(e.publicationForm.$valid){var a=t.defer();h.savePublication(e.publication.model,I,e.publication.$id).then(function(t){return e.publication.$id=""!==e.publication.$id?e.publication.$id:t.publicationId,b.saveFiles(I,e.publication.$id,e.publication.images)}).then(function(){m.success("Data has been save"),a.resolve()},function(e){m.error(e),a.reject(e)}),e.httpRequestPromise=a.promise}else m.error("Something is missing")},e.discard=function(){var t=g.open({templateUrl:"discardPublication.html",controller:"DiscardPublicationController",resolve:{publicationId:function(){return""!==e.publication.$id},title:function(){return""!==e.publication.model.title&&void 0!==e.publication.model.title?e.publication.model.title:"Untitled"}}});t.result.then(function(){""!==e.publication.$id?e.httpRequestPromise=h.removePublication(I,e.publication.$id).then(function(){m.success("The publication has been deleted."),r.path("/")}):(m.success("The publication has been discard."),r.path("/"))},function(e){m.error(e)})}}]).controller("DiscardPublicationController",["$scope","$modalInstance","publicationId","title",function(e,t,a,o){e.publication={$id:a,title:o},e.confirm=function(){t.close()},e.cancel=function(){t.dismiss("This has be cancel")}}]).directive("locationInput",["treeService",function(e){return{scope:{formName:"=",locations:"=",model:"=",redefineLocation:"=",locationPath:"="},template:'<div><hr class="hr-xs"><label class="control-label"><i class="fa fa-map-marker"></i> Location <sup style="color: red;">*</sup></label><div class="list-group" style="margin-bottom: 0"><button type="button" class="list-group-item" ng-click="setLocation(location.$id); publication.redefineLocation = false;" ng-repeat="location in locations | filter:{parentId: model.locationId}:true" ><i style="color: #286090" class="fa fa-folder"></i> {{location.name | capitalizeFirstChar}}</button></div><ol ng-show="locationPath.length > 0" class="breadcrumb" style="margin-bottom: 0; margin-top: 10px;"><li ng-click="model.locationId =\'\'; locationPath =[];" class="a-link"> Reset </li><li ng-repeat="location in locationPath" ng-click="setLocation(location.$id)" ng-class="{\'a-link\': !$last}"> {{location.name | capitalizeFirstChar}} </li></ol><input name="location" ng-model="model.locationId" required class="form-control" placeholder="" type="text" style="display: none;"><div data-ng-messages="formName.$submitted && formName.location.$error" class="help-block"><div data-ng-message="required" >- The <b>Location</b> is required.</div></div><div ng-show="formName.redefineLocation === true" class="alert alert-danger alert-xs" style="margin-bottom: 10px;" role="alert"><b>NOTE: Sorry, but we need to redefine the location.</b></div><div class="alert alert-info alert-xs" style="margin-bottom: 0; margin-top: 10px;" role="alert">NOTE: Select the <b>location</b> that best suits to the publication. No matter if it is too general or specific, the important thing is to select one.</div></div>',link:function(t){t.setLocation=function(a){t.model.locationId=a,t.locationPath=e.getPath(a,t.locations),t.model.locations=e.pathNames(t.locationPath)}}}}]).directive("categorySelector",["treeService",function(e){return{restrict:"E",scope:{categoryPath:"=",categorySelected:"=",isReady:"=",inEditMode:"=",model:"=",categories:"=",redefineCategory:"="},template:'<div class="panel panel-default" ng-show="categorySelected === false && isReady"><div class="panel-heading"><h3 class="panel-title" ng-switch="inEditMode"><span ng-switch-when="false" >New Publication - Select a category:</span><span ng-switch-when="true">Edit Publication</span></h3></div><div class="list-group"><button type="button" class="list-group-item" ng-click="setCategory(category.$id)" ng-repeat="category in categories | filter:{parentId: model.categoryId}:true" ><i style="color: #286090" class="fa" ng-class="{\'fa-folder\': (category.name !== \'Marketplace\' && category.name !== \'Jobs\' && category.name !== \'Real Estate\' && category.name !== \'Transport\' && category.name !== \'Services\') , \'fa-shopping-cart\': (category.name === \'Marketplace\') , \'fa-suitcase\': (category.name === \'Jobs\'), \'fa-home\': (category.name === \'Real Estate\'), \'fa-car\': (category.name === \'Transport\'), \'fa-wrench\' : (category.name === \'Services\')}"></i> {{category.name | capitalizeFirstChar}}</button></div><div class="panel-body"><ol ng-show="categoryPath.length > 0" class="breadcrumb" style="margin-bottom: 7px;"><li ng-click="model.categoryId = \'\'; categoryPath =[];" class="a-link"> Reset </li><li ng-repeat="category in categoryPath" ng-click="setCategory(category.$id)" ng-class="{\'a-link\': !$last}"> {{category.name | capitalizeFirstChar}} </li></ol><div ng-show="redefineCategory === true" class="alert alert-danger alert-xs" style="margin-bottom: 10px;" role="alert"><b>NOTE: Sorry, but we need to redefine the category.</b></div><div class="alert alert-info alert-xs" style="margin-bottom: 0;" role="alert">NOTE: Select the category that best suits to the publication. No matter if it is too general or specific, the important thing is to select one.</div></div><div class="panel-footer" style="text-align: right;"><button ng-click="categorySelected = true; redefineCategory = false" type="button" class="btn btn-primary" ng-disabled="model.categoryId ===\'\'" ><i class="fa fa-check"></i> Confirm selection</button></div></div>',link:function(t){t.setCategory=function(a){t.model.categoryId=a,t.categoryPath=e.getPath(a,t.categories),t.model.categories=e.pathNames(t.categoryPath),t.model.department=t.categoryPath[0]?t.categoryPath[0].name:""}}}}]).directive("descriptionInput",["$filter",function(e){return{restrict:"E",scope:{formName:"=",model:"="},template:'<div class="form-group"><label class="control-label"><span class="glyphicon glyphicon-book"></span> Description <sup style="color: red;">*</sup></label><textarea redactor name="htmlDescription" data-ng-model="model.htmlDescription" required class="form-control" placeholder=""></textarea><div data-ng-messages="formName.$submitted && formName.htmlDescription.$error" class="help-block"><div data-ng-message="required" >- The <b>description</b> is required.</div></div></div>',link:function(t){t.$watch(function(e){return e.model.htmlDescription},function(){t.model.description=e("htmlToPlaintext")(t.model.htmlDescription)})}}}]).directive("warrantyInput",["$filter",function(e){return{restrict:"E",scope:{formName:"=",model:"="},template:'<div class="form-group"><label class="control-label"><i class="fa fa-certificate"></i> Warranty <sup style="color: red;">*</sup></label><textarea redactor name="htmlWarranty" data-ng-model="model.htmlWarranty" required class="form-control" placeholder=""></textarea><div data-ng-messages="formName.$submitted && formName.htmlWarranty.$error" class="help-block"><div data-ng-message="required" >- The <b>Warranty</b> is required.</div></div></div>',link:function(t){t.$watch(function(e){return e.model.htmlWarranty},function(){t.model.warranty=e("htmlToPlaintext")(t.model.htmlWarranty)})}}}]).directive("titleInput",["$filter",function(e){return{restrict:"E",scope:{formName:"=",model:"="},template:'<div class="form-group"><label class="control-label"><span class="glyphicon glyphicon-bookmark"></span> Title <sup style="color: red;">*</sup></label><input type="text" name="title" ng-model="model.title" required minlength="7" capitalize-first-char class="form-control" placeholder=""><div data-ng-messages="formName.$submitted && formName.title.$error" class="help-block"><div data-ng-message="required">- The <b>title</b> is required.</div><div data-ng-message="minlength" >- The <b>title</b> must be at least 7 characters long.</div></div></div>'}}]).directive("quantityInput",[function(){return{restrict:"E",scope:{formName:"=",model:"="},template:'<div class="form-group" ><div class="row"><div class="col-xs-4"><label class="control-label"><i class="fa fa-cubes"></i> Quantity in stock <sup style="color: red;">*</sup></label><div class="input-group"><div class="input-group-addon">Units</div><input name="quantity" ng-model="model.quantity" required class="form-control" placeholder="Eje: 100" type="number"></div><div data-ng-messages="formName.$submitted && formName.quantity.$error" class="help-block"><div data-ng-message="required">- The <b>quantity</b> is required.</div></div></div></div></div>'}}]).directive("priceInput",[function(){return{restrict:"E",scope:{formName:"=",model:"="},template:'<div class="form-group" ><div class="row"><div class="col-xs-4"><label class="control-label"><span class="glyphicon glyphicon-tag"></span> Price <sup style="color: red;">*</sup></label><div class="input-group"><div class="input-group-addon">£</div><input name="price" ng-model="model.price" required class="form-control" placeholder="Eje: 1000" type="number"></div><div data-ng-messages="formName.$submitted && formName.price.$error" class="help-block"><div data-ng-message="required">- The <b>price</b> is required.</div></div></div></div></div>'}}]).directive("jobTypeSelect",[function(){return{restrict:"E",scope:{model:"="},template:'<hr class="hr-xs"><label><i class="fa fa-random"></i> Job type</label><div class="row" style="margin-bottom: 10px;"><div class="col-xs-5"><select class="form-control" ng-model="model.jobType"><option ng-repeat="type in jobTypes" value="{{type}}">{{type}}</option></select></div></div>',link:function(e){"undefined"==typeof e.model.jobType&&(e.model.jobType="Permanent"),e.jobTypes=["Permanent","Contract"]}}}]).directive("salaryInput",[function(){return{restrict:"E",scope:{formName:"=",model:"="},template:'<hr class="hr-xs"><div class="row"><div class="col-xs-8"><label><i class="fa fa-gbp"></i> Salary</label><div class="row" style="margin-bottom: 10px;"><div class="col-xs-5"><select class="form-control" ng-model="model.jobSalaryType"><option ng-repeat="salaryType in jobSalaryTypes" value="{{salaryType}}"> {{salaryType}} </option></select></div></div><label><i class="fa fa-gbp"></i> From:</label><div class="form-group" style="margin-bottom: 10px;"><input name="jobSalaryStartAt" ng-model="model.jobSalaryStartAt" required class="form-control" placeholder="<Base salary or start at>" type="number"></div><div data-ng-messages="(formName.$submitted && formName.jobSalaryStartAt.$error) || (formName.jobSalaryStartAt.$dirty && formName.jobSalaryStartAt.$error)" class="help-block"><div data-ng-message="required">- The <b>start or base salary</b> is required.</div></div><label><i class="fa fa-gbp"></i> To:</label><div class="form-group" style="margin-bottom: 10px;"><input name="jobSalaryEndAt" ng-model="model.jobSalaryEndAt" required class="form-control" placeholder="<End at>" type="number"></div><div data-ng-messages="(formName.$submitted && formName.jobSalaryEndAt.$error) || (formName.jobSalaryEndAt.$dirty && formName.jobSalaryEndAt.$error)" class="help-block"><div data-ng-message="required">- The <b> max salary </b> is required.</div></div><div class="checkbox"><label><input ng-model="model.jobHasBonus" type="checkbox"> The job Has Bonus?</label></div><div class="checkbox" style="margin-bottom: 0;"><label><input ng-model="model.jobHasBenefits" type="checkbox"> The job Has Benefits?</label></div></div></div>',link:function(e){function t(){switch(e.model.jobSalaryType){case"Annual":e.model.jobEstimatedMonthlySalary=e.model.jobSalaryStartAt/12;break;case"Daily":e.model.jobEstimatedMonthlySalary=21.741*e.model.jobSalaryStartAt;break;case"Hourly":e.model.jobEstimatedMonthlySalary=8*e.model.jobSalaryStartAt*21.741}}"undefined"==typeof e.model.jobSalaryStartAt&&(e.model.jobSalaryStartAt=null),"undefined"==typeof e.model.jobSalaryEndAt&&(e.model.jobSalaryEndAt=null),"undefined"==typeof e.model.jobHasBonus&&(e.model.jobHasBonus=!1),"undefined"==typeof e.model.jobHasBenefits&&(e.model.jobHasBenefits=!1),"undefined"==typeof e.model.jobSalaryType&&(e.model.jobSalaryType="Annual"),e.jobSalaryTypes=["Annual","Daily","Hourly"],e.$watch(function(e){return e.model.jobSalaryType},function(){t()}),e.$watch(function(e){return e.model.jobSalaryStartAt},function(){t()})}}}]).directive("recruiterTypesSelect",[function(){return{restrict:"E",scope:{model:"="},template:'<hr class="hr-xs"><label><i class="fa fa-random"></i> Recruiter type</label><div class="row" style="margin-bottom: 10px;"><div class="col-xs-5"><select class="form-control" ng-model="model.jobRecruiterType"><option ng-repeat="type in recruiterTypes" value="{{type}}">{{type}}</option></select></div></div>',link:function(e){"undefined"==typeof e.model.jobRecruiterType&&(e.model.jobRecruiterType="Agency"),e.recruiterTypes=["Agency","Direct Employer"]}}}]).directive("reHomeStatus",[function(){return{restrict:"E",scope:{model:"="},template:'<hr class="hr-xs"><label><i class="fa fa-random"></i> Home status</label><div class="row" style="margin-bottom: 10px;"><div class="col-xs-5"><select class="form-control" ng-model="model.reHomeStatus"><option ng-repeat="option in options" value="{{option}}">{{option}}</option></select></div></div>',link:function(e){"undefined"==typeof e.model.reHomeStatus&&(e.model.reHomeStatus="New"),e.options=["New","Refurbished","Used"]}}}]).directive("reHomeFor",[function(){return{restrict:"E",scope:{model:"="},template:'<hr class="hr-xs"><label><i class="fa fa-random"></i> Home for</label><div class="row" style="margin-bottom: 10px;"><div class="col-xs-5"><select class="form-control" ng-model="model.reHomeFor"><option ng-repeat="option in options" value="{{option}}">{{option}}</option></select></div></div>',link:function(e){"undefined"==typeof e.model.reHomeFor&&(e.model.reHomeFor="Sale"),e.options=["Sale","Rent"]}}}]);publicationsModule.controller("ViewPublicationController",["$scope","$q","$window","$filter","$routeParams","$location","$http","FireRef","$firebaseArray","$firebaseObject","rfc4122","notificationService","Upload","$uibModal","$log",function(e,t,a,o,i,r,n,l,c,s,d,u,m,p,f){function g(e){var a=t.defer(),o=h.child(e),i=s(o);return i.$loaded(function(){"undefined"==typeof i.releaseDate?a.reject():a.resolve({publication:i})},function(e){a.reject(e)}),a.promise}var h=l.child("publications");e.c={},e.barcode={string:"",options:{width:1,height:50,quite:10,format:"CODE128",
displayValue:!0,font:"monospace",textAlign:"center",fontSize:12,backgroundColor:"",lineColor:"#000"}},angular.isDefined(i.publicationId)?e.httpRequestPromise=g(i.publicationId).then(function(t){e.publication=t.publication,e.publicationImages=[],e.barcode.string=t.publication.barcode,e.seo={url:"https://londres.herokuapp.com/#/view-publication/"+t.publication.$id+"/"+o("slug")(t.publication.title)+".html"},angular.forEach(t.publication.images,function(a,o){a.$id=o,o!==t.publication.featuredImageId?e.publicationImages.push(a):e.publicationImages.unshift(a)})},function(){u.error("This action cannot be completed."),r.path("/")}):(u.error("This action cannot be completed."),r.path("/"))}]).directive("facebook",["$window",function(e){return{restrict:"E",scope:{url:"="},template:'<div class="fb-like" data-href="{{url}}" data-layout="button_count" data-action="like" data-show-faces="true" data-share="true"></div>',link:function(){"undefined"!=typeof e.FB&&e.FB.XFBML.parse()}}}]),publicationsModule.directive("barcodeImg",["$compile","$window",function(e,t){function a(){var e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))}return{restrict:"E",scope:{barcodeString:"=",barcodeOptions:"="},link:function(o,i){var r="",n="";a()?(r='<canvas id="barcode-img"></canvas>',n="canvas"):(r='<img id="barcode-img">',n="img"),i.html(e(r)(o)),"undefined"!=typeof o.barcodeString&&("undefined"==typeof o.barcodeOptions&&(o.barcodeOptions={}),o.$watch(function(){return o.barcodeString},function(e){t.JsBarcode(i.find(n),e,o.barcodeOptions)}))}}}]).directive("barcode",["$window",function(e){return{restrict:"A",require:"ngModel",scope:{barcodeOptions:"="},link:function(t,a,o,i){function r(e){n=e}"undefined"==typeof t.barcodeOptions&&(t.barcodeOptions={});var n;i.$validators.barcode=function(a){var o=document.getElementById("barcode-img");return"undefined"==typeof o&&(o=document.createElement("div")),e.JsBarcode(o,a,t.barcodeOptions,r),n}}}}]).directive("barcodeInput",["rfc4122",function(e){return{restrict:"E",scope:{formName:"=",inputModel:"=",selectModel:"="},template:'<hr class="hr-xs"><div class="row"><div class="col-xs-8"><label><i class="fa fa-barcode"></i> Barcode</label><div class="row" style="margin-bottom: 10px;"><div class="col-xs-5"><select class="form-control" ng-model="selectModel" ng-change="formName.barcode.$dirty = true; formName.barcode.$pristine = false; inputModel = \'\';"><option ng-repeat="barcode in barcode.types" value="{{barcode.type}}">{{barcode.title}}</option></select></div><div class="col-xs-5"><button ng-show="selectModel === \'CODE128\'" class="btn btn-default" type="button" ng-click="setBarcodeCODE128Randomly(); formName.barcode.$dirty = true; formName.barcode.$pristine = false;">Set one CODE128 type randomly</button></div></div><div class="form-group" style="margin-bottom: 10px;"><input name="barcode" ng-model="inputModel" required barcode barcode-options="barcode.options" class="form-control" placeholder="<Place here the bar code>" type="text"></div><div data-ng-messages="(formName.$submitted && formName.barcode.$error) || (formName.barcode.$dirty && formName.barcode.$error)" class="help-block"><div data-ng-message="required">- The <b>barcode</b> is required.</div><div data-ng-message="barcode">- The <b>barcode </b> must be valid.</div></div><barcode-img ng-show="!formName.barcode.$error.barcode"></barcode-img></div></div><div class="alert alert-info alert-xs" style="margin-bottom: 0; margin-top: 10px;" role="alert">NOTE: The <b>barcode</b> is obligatory for all type of publications, if you don\'t have one, you can set one CODE128 type randomly, with the barcode you and the clients can track this publication in many ways, and other publications they can maybe have the same barcode.</div>',link:function(t){t.barcode={types:[{title:"EAN (13)",type:"EAN"},{title:"UPC-A",type:"UPC"},{title:"CODE39",type:"CODE39"},{title:"CODE128",type:"CODE128"},{title:"ITF (Interleaved 2 of 5)",type:"ITF"},{title:"ITF14",type:"ITF14"},{title:"Pharmacode",type:"pharmacode"}],options:{width:1,height:50,quite:10,format:"CODE128",displayValue:!0,font:"monospace",textAlign:"center",fontSize:12,backgroundColor:"",lineColor:"#000"}},t.setBarcodeCODE128Randomly=function(){t.inputModel=e.v4()},t.$watch(function(){return t.selectModel},function(e){t.barcode.options.format=e})}}}]),publicationsModule.factory("imagesService",["$q","$http","$window","Upload",function(e,t,a,o){function i(t,a,i){var r=e.defer();return t.upload=o.upload({url:"https://api.cloudinary.com/v1_1/berlin/upload",fields:{public_id:a,upload_preset:"ebdyaimw",context:"alt="+t.name+"|caption="+t.name+"|photo="+t.name+"|$id="+a,tags:[i]},file:t}).progress(function(e){t.progress=Math.round(100*e.loaded/e.total)}).success(function(e){t.inServer=!0,t.$id=e.context.custom.$id,r.resolve({$id:e.context.custom.$id})}).error(function(e){t.details=e,r.reject()}),r.promise}return{deleteImages:function(a,o){var i=e.defer(),r={publicationId:a};return"undefined"!=typeof o&&Array.isArray(o)&&(r.public_ids=o),t({method:"DELETE",url:"/files",params:r}).then(function(e){i.resolve(e)},function(e){i.reject(e)}),i.promise},saveFiles:function(t,o,r){var n=t.child(o).child("images"),l={},c={};return angular.forEach(r,function(e){if(!angular.isDefined(e.inServer)){var t=n.push();c[t.key()]=t,l[t.key()]=i(e,t.key(),o).then(function(t){return c[t.$id].set({name:e.name,size:e.size,type:e.type,width:e.width,height:e.height,inServer:!0,addedDate:a.Firebase.ServerValue.TIMESTAMP})})}}),e.all(l)},saveFiles2:function(t,o,i){var r=t.child(o).child("images"),n={},l={};return angular.forEach(i,function(e){if(!angular.isDefined(e.inServer)){var t=r.push();l[t.key()]=t,n[t.key()]=Upload.upload({url:"https://api.cloudinary.com/v1_1/berlin/upload",data:{file:e,public_id:t.key(),upload_preset:"ebdyaimw",context:"alt="+e.name+"|caption="+e.name+"|photo="+e.name+"|$id="+t.key(),tags:o}}).then(function(t){return e.inServer=!0,e.$id=t.data.public_id,l[t.data.public_id].set({name:t.data.original_filename+"."+t.data.format,size:t.data.bytes,type:t.data.format,width:t.data.width,height:t.data.height,inServer:!0,addedDate:a.Firebase.ServerValue.TIMESTAMP})},function(t){e.details=t},function(t){e.progress=Math.round(100*t.loaded/t.total)})}}),e.all(n)},featuredImage:function(t,a){function o(e){e?i.reject(e):i.resolve()}var i=e.defer(),r={};return angular.isDefined(a)&&""!==a?r.featuredImageId=a:r.featuredImageId="",t.update(r,o),i.promise}}}]).directive("publicationImages",["$q","$filter","FireRef","notificationService","imagesService",function(e,t,a,o,i){return{scope:{formName:"=",images:"=",publicationId:"=",model:"=",httpRequestPromise:"="},templateUrl:"publicationImages.html",link:function(r){var n=a.child("publications");r.imagesInfo=function(){var e={inQueue:0,inServer:0,invalid:0};return angular.forEach(r.images,function(t){angular.isDefined(t.inServer)||angular.isDefined(t.$error)?angular.isDefined(t.inServer)?e.inServer+=1:e.invalid+=1:e.inQueue+=1}),e},r.deleteAllPublicationImages=function(){i.deleteImages(r.publicationId,null).then(function(){var e=n.child(r.publicationId),t=e.child("images");return t.set({})}).then(function(){angular.copy([],r.images),o.success("The images has been deleted")},function(){o.error("The images cannot be deleted")})},r.setAsPrimaryImage=function(e){var t=n.child(r.publicationId);r.httpRequestPromise=i.featuredImage(t,e).then(function(){r.model.featuredImageId=e,o.success("The file as been selected as featured image.")})},r.removeFile=function(a,l){function c(e){r.images=t("filter")(r.images,function(t,a){return a!==e}),o.success("The file as been delete.")}if(angular.isDefined(l.inServer)){var s={};if(l.$id===r.model.featuredImageId){var d=n.child(r.publicationId);s.blankFeaturedImage=i.featuredImage(d).then(function(){r.model.featuredImageId=""})}s.deleteImage=i.deleteImages(r.publicationId,[l.$id]).then(function(){var e=n.child(r.publicationId).child("images").child(l.$id);return e.set({})}).then(function(){c(a)},function(e){o.error(e)}),r.httpRequestPromise=e.all(s)}else c(a)},r.removeInvalidFiles=function(){r.images=t("filter")(r.images,function(e){return!angular.isDefined(e.$error)})},r.removeAllQueueFiles=function(){r.images=t("filter")(r.images,function(e){return!(!angular.isDefined(e.inServer)&&!angular.isDefined(e.$error))}),o.success("All queue files have been removed.")}}}}]),publicationsModule.controller("ListPublicationsController",["$scope","$q","$location","$window","algolia","FireRef","$firebaseArray","$routeParams","$filter",function(e,t,a,o,i,r,n,l,c){function s(){var a=t.defer(),i=o.Object.keys(e.algolia.faceting.currentFacets).length,r=0;return e.algolia.req.facetFilters=[],angular.forEach(e.algolia.faceting.currentFacets,function(t,o){t.length>0&&angular.forEach(t,function(t){e.algolia.req.facetFilters.push(o+":"+t.name)}),r++,i===r&&a.resolve()}),a.promise}function d(){function a(){i.search(e.algolia.req).then(function(t){t.query!==e.algolia.req.query?a():(e.algolia.res=t,u("categories"),u("locations"),o.resolve())},function(e){o.reject(e)})}var o=t.defer(),i=f.initIndex(e.algolia.sortOrder.currentIndexName);return a(),o.promise}function u(t){e.algolia.faceting.facetsAvailables[t]=[],angular.forEach(e.algolia.res.facets[t],function(a,o){angular.forEach(g[t],function(i){if(o===i.name)if(angular.isDefined(e.algolia.faceting.currentFacets[t])&&e.algolia.faceting.currentFacets[t].length>0){var r=e._(e.algolia.faceting.currentFacets[t]).last();i.parentId===r.$id&&(i.count=a,e.algolia.faceting.facetsAvailables[t].push(i))}else""===i.parentId&&(i.count=a,e.algolia.faceting.facetsAvailables[t].push(i))})})}function m(){e.algolia.sortOrder.changeIndexName("publications"),angular.copy({},e.algolia.faceting.currentFacets),e.algolia.req.facetFilters=[],e.algolia.req.page=0,e.algolia.pagination.currentPage=1}var p={},f=i.Client("FU6V8V2Y6Q","75b635c7c8656803b0b9e82e0510f266"),g={categories:n(r.child("categories").orderByChild("left")),locations:n(r.child("locations").orderByChild("left"))};p.categories=g.categories.$loaded(),p.locations=g.locations.$loaded(),e.algolia={req:{query:"",facets:"*",typoTolerance:!1,facetFilters:[],hitsPerPage:7,getRankingInfo:1,page:0,highlightPreTag:"<b>",highlightPostTag:"</b>"},res:{},pagination:{maxSize:10,currentPage:1,pageChanged:function(){e.algolia.req.page=e.algolia.pagination.currentPage-1,d()}},sortOrder:{currentIndexName:"publications",changeIndexName:function(t){e.algolia.sortOrder.currentIndexName=t},sortBy:function(){e.algolia.req.page=0,e.algolia.pagination.currentPage=1,d()},options:{Marketplace:[{title:"Relevance",indexName:"publications"},{title:"Low prices publications",indexName:"publications_by_price_asc"},{title:"Highest prices publications",indexName:"publications_by_price_desc"},{title:"Latest publications",indexName:"publications_by_releaseDate_desc"},{title:"Old publications",indexName:"publications_by_releaseDate_asc"}],Jobs:[{title:"Relevance",indexName:"publications"},{title:"Highest salary publications",indexName:"publications_by_salary_desc"},{title:"Low salary publications",indexName:"publications_by_salary_asc"},{title:"Latest publications",indexName:"publications_by_releaseDate_desc"},{title:"Old publications",indexName:"publications_by_releaseDate_asc"}],"Real Estate":[{title:"Relevance",indexName:"publications"},{title:"Low prices publications",indexName:"publications_by_price_asc"},{title:"Highest prices publications",indexName:"publications_by_price_desc"},{title:"Latest publications",indexName:"publications_by_releaseDate_desc"},{title:"Old publications",indexName:"publications_by_releaseDate_asc"}],Transport:[{title:"Relevance",indexName:"publications"},{title:"Low prices publications",indexName:"publications_by_price_asc"},{title:"Highest prices publications",indexName:"publications_by_price_desc"},{title:"Latest publications",indexName:"publications_by_releaseDate_desc"},{title:"Old publications",indexName:"publications_by_releaseDate_asc"}],Services:[{title:"Relevance",indexName:"publications"},{title:"Latest publications",indexName:"publications_by_releaseDate_desc"},{title:"Old publications",indexName:"publications_by_releaseDate_asc"}]}},faceting:{facetsAvailables:{userID:[],categories:[],locations:[],jobType:[],jobRecruiterType:[],jobSalaryType:[],reHomeStatus:[],reHomeFor:[],jobHasBenefits:[],jobHasBonus:[]},currentFacets:{userID:[],categories:[],locations:[],jobType:[],jobRecruiterType:[],jobSalaryType:[],reHomeStatus:[],reHomeFor:[],jobHasBenefits:[],jobHasBonus:[]},treeFacetsMethods:{addFacet:function(t,a){e.algolia.faceting.currentFacets[t]=angular.isDefined(e.algolia.faceting.currentFacets[t])?e.algolia.faceting.currentFacets[t]:[],e.algolia.faceting.currentFacets[t].push(a),e.algolia.req.facetFilters.push(t+":"+a.name),d()},removeAllFacet:function(t){e.algolia.req.page=0,e.algolia.pagination.currentPage=1,angular.copy([],e.algolia.faceting.currentFacets[t]),"categories"===t&&(angular.copy([],e.algolia.faceting.currentFacets.reHomeStatus),angular.copy([],e.algolia.faceting.currentFacets.reHomeFor),angular.copy([],e.algolia.faceting.currentFacets.jobType),angular.copy([],e.algolia.faceting.currentFacets.jobSalaryType),angular.copy([],e.algolia.faceting.currentFacets.jobRecruiterType),angular.copy([],e.algolia.faceting.currentFacets.jobHasBenefits),angular.copy([],e.algolia.faceting.currentFacets.jobHasBonus)),s().then(function(){e.algolia.sortOrder.changeIndexName("publications"),d()})},removeFacet:function(t,a,o){var i=[];angular.copy(e.algolia.faceting.currentFacets[t],i),angular.copy([],e.algolia.faceting.currentFacets[t]);for(var r=0;o>=r;r++)e.algolia.faceting.currentFacets[t].push(i[r]),r===o&&s().then(function(){d()})}},facetsMethods:{addFacet:function(t,a){var o={};o.name=a,e.algolia.faceting.currentFacets[t]=angular.isDefined(e.algolia.faceting.currentFacets[t])?e.algolia.faceting.currentFacets[t]:[],e.algolia.faceting.currentFacets[t].push(o),e.algolia.req.facetFilters.push(t+":"+o.name),d()},removeFacet:function(t){angular.copy([],e.algolia.faceting.currentFacets[t]),s().then(function(){e.algolia.sortOrder.changeIndexName("publications"),d()})}}}},e.submit=function(){m(),d().then(null,function(e){notificationService.error(e)})};var h=t.defer();e.httpRequestPromise=h.promise,t.all(p).then(function(){e.$watch(function(){return e.algolia.req.query},function(){if(m(),"undefined"!=typeof e.account){var t={};t.name=e.account.user.uid,e.algolia.faceting.currentFacets.userID=[],e.algolia.faceting.currentFacets.userID.push(t),e.algolia.req.facetFilters.push("userID:"+t.name)}d().then(null,function(e){notificationService.error(e)})})}).then(function(){e.thePublicationsAreReady=!0,h.resolve()}),e.viewPublication=function(e){a.path("/view-publication/"+e)},e.editPublication=function(e){a.path("/edit-publication/"+e)}}]),angular.module("login",["ngMessages","validation.match","trTrustpass","ngPasswordStrength"]).controller("LoginController",["$scope","FireAuth","$location","$q","FireRef","notificationService","$window","$log",function(e,t,a,o,i,r,n,l){var c=angular.copy(e.model={signIn:{email:"",password:"",rememberMe:!1},register:{names:"",lastNames:"",email:"",password:"",samePassword:""},recoverAccount:{email:""}});e.forms={signIn:{},register:{},recoverAccount:{}},e.resetRegisterForm=function(){angular.copy(c.register,e.model.register),e.forms.register.$setUntouched(),e.forms.register.$setPristine()},e.resetSignInForm=function(){angular.copy(c.signIn,e.model.signIn),e.forms.signIn.$setUntouched(),e.forms.signIn.$setPristine()};var s=function(){n.location="#/new-publication"},d=function(e){switch(e.code){case"AUTHENTICATION_DISABLED":r.error("The requested authentication provider is disabled for this Firebase application.");break;case"EMAIL_TAKEN":r.error("The new user account cannot be created because the email is already in use.");break;case"INVALID_ARGUMENTS":r.error("The specified credentials are malformed or incomplete. Please refer to the error message, error details, and Firebase documentation for the required arguments for authenticating with this provider.");break;case"INVALID_CONFIGURATION":r.error("The requested authentication provider is misconfigured, and the request cannot complete. Please confirm that the provider 's client ID and secret are correct in your App Dashboard and the app is properly set up on the provider 's website.");break;case"INVALID_CREDENTIALS":r.error("The requested authentication provider is misconfigured, and the request cannot complete. Please confirm that the provider 's client ID and secret are correct in your App Dashboard and the app is properly set up on the provider 's website.");break;case"INVALID_EMAIL":r.error("The specified email is not a valid email.");break;case"INVALID_ORIGIN":r.error("A security error occurred while processing the authentication request. The web origin for the request is not in your list of approved request origins. To approve this origin, visit the Login & Auth tab in your App Dashboard.");break;case"INVALID_PASSWORD":r.error("The specified user account password is incorrect.");break;case"INVALID_PROVIDER":r.error("The requested authentication provider does not exist. Please consult the Firebase Authentication documentation for a list of supported providers.");break;case"INVALID_TOKEN":r.error("The specified authentication token is invalid. This can occur when the token is malformed, expired, or the Firebase app secret that was used to generate it has been revoked.");break;case"INVALID_USER":r.error("The specified user account does not exist.");break;case"NETWORK_ERROR":r.error("An error occurred while attempting to contact the authentication server.");break;case"PROVIDER_ERROR":r.error("A third-party provider error occurred. Please refer to the error message and error details for more information.");break;case"TRANSPORT_UNAVAILABLE":r.error("The requested login method is not available in the user's browser environment. Popups are not available in Chrome for iOS, iOS Preview Panes, or local, file:// URLs. Redirects are not available in PhoneGap / Cordova, or local, file:// URLs.");break;case"UNKNOWN_ERROR":r.error("An unknown error occurred. Please refer to the error message and error details for more information.");break;case"USER_CANCELLED":r.error("The current authentication request was cancelled by the user.");break;case"USER_DENIED":r.error("The user did not authorize the application. This error can occur when the user has cancelled an OAuth authentication request.");break;default:r.error("Undefined Error: ",e)}},u=function(t){var a=o.defer(),r=i.child("users").child(t.uid),n={};return r.once("value",function(o){var i=null!==o.val();if(i)a.resolve();else{switch(t.provider){case"facebook":n.names=t.facebook.displayName,n.provider=t.provider;break;case"twitter":n.names=t.twitter.displayName,n.provider=t.provider;break;case"password":n.email=e.model.register.email,n.names=e.model.register.names,n.lastNames=e.model.register.lastNames,n.provider=t.provider}r.set(n,function(e){e?a.reject(e):a.resolve()})}}),a.promise},m=function(){var a=o.defer();return t.$createUser({email:e.model.register.email,password:e.model.register.password}).then(function(){return t.$authWithPassword({email:e.model.register.email,password:e.model.register.password},{rememberMe:!0})}).then(u).then(function(){a.resolve()},function(e){a.reject(e)}),a.promise};e.register=function(){e.forms.register.$setSubmitted(!0),e.forms.register.$valid&&(e.httpRequestPromise=m().then(function(){s()},function(e){d(e)}))};var p=function(){var a=o.defer(),i=e.model.signIn.rememberMe?"default":"sessionOnly";return t.$authWithPassword({email:e.model.signIn.email,password:e.model.signIn.password},{remember:i}).then(function(e){l.info("authData",e),a.resolve()},function(e){a.reject(e)}),a.promise};e.signIn=function(){e.forms.signIn.$setSubmitted(!0),e.forms.signIn.$valid&&(e.httpRequestPromise=p().then(function(){s()},function(e){d(e)}),l.info("ok fromJson",angular.fromJson(e.model.signIn)),l.info("ok toJson",angular.toJson(e.model.signIn)))};var f=function(){var a=o.defer();return t.$resetPassword({email:e.model.recoverAccount.email}).then(function(){a.resolve()})["catch"](function(e){a.reject(e)}),a.promise};e.recover=function(){e.forms.recoverAccount.$setSubmitted(!0),e.forms.recoverAccount.$valid&&(e.httpRequestPromise=f().then(function(){r.success("Password reset email sent successfully!")},function(e){d(e)}),l.info("ok fromJson",angular.fromJson(e.model.recoverAccount)),l.info("ok toJson",angular.toJson(e.model.recoverAccount)))},e.oauthLogin=function(e){t.$authWithOAuthPopup(e,{rememberMe:!0}).then(function(e){return u(e)}).then(s,d)}}]),$.cloudinary.config().cloud_name="berlin",angular.module("account",["trTrustpass","ngPasswordStrength","cloudinary","algoliasearch"]).controller("AccountController",["$scope","$q","user","$uibModal","FireRef","$firebaseObject","notificationService","$log",function(e,t,a,o,i,r,n,l){e.account={user:a,profile:r(i.child("users/"+a.uid)),publications:{},publicationsImages:{}}}]).controller("AccountProfileController",["$scope","$uibModal","notificationService",function(e,t,a){e.account.httpRequestPromise=e.account.profile.$loaded(null,function(e){a.error(e)});var o=function(e){switch(e){case"escape key press":a.notice("This action was canceled by the user");break;case void 0:a.notice("This action was canceled by the user");break;case"backdrop click":a.notice("This action was canceled by the user");break;default:a.error(e)}};e.changeProfileDetails=function(i){var r=t.open({templateUrl:"accountProfileDetailsModal.html",controller:"AccountProfileDetailsModalController",size:i,resolve:{profile:function(){return e.account.profile}}});r.result.then(function(){a.success("The profile has been updated.")},function(e){o(e)})},e.changePassword=function(i){var r=t.open({templateUrl:"accountProfilePasswordModal.html",controller:"AccountProfilePasswordModalController",size:i,resolve:{profile:function(){return e.account.profile}}});r.result.then(function(){a.success("The password has been updated.")},function(e){o(e)})},e.changeEmail=function(i){var r=t.open({templateUrl:"accountProfileEmailModal.html",controller:"AccountProfileEmailModalController",size:i,resolve:{profile:function(){return e.account.profile}}});r.result.then(function(){a.success("The email has been updated.")},function(e){o(e)})}}]).controller("AccountBillingController",["$scope",function(e){}]).controller("AccountProfileDetailsModalController",["$scope","$modalInstance","profile",function(e,t,a){e.forms={profileDetails:{}},e.profile=a;angular.copy(e.model={profileDetails:{names:angular.isDefined(a.names)&&""!==a.names?a.names:"",lastNames:angular.isDefined(a.lastNames)&&""!==a.lastNames?a.lastNames:"",mobilePhone:angular.isDefined(a.mobilePhone)&&""!==a.mobilePhone?a.mobilePhone:"",landLineTelephone:angular.isDefined(a.landLineTelephone)&&""!==a.landLineTelephone?a.landLineTelephone:"",email:angular.isDefined(a.email)&&""!==a.email?a.email:""}});e.submit=function(){e.forms.profileDetails.$valid&&(a.names=e.model.profileDetails.names,a.lastNames=e.model.profileDetails.lastNames,a.mobilePhone=e.model.profileDetails.mobilePhone,a.landLineTelephone=e.model.profileDetails.landLineTelephone,"password"!==a.provider&&(a.email=angular.isDefined(e.model.profileDetails.email)?e.model.profileDetails.email:""),e.httpRequestPromise=a.$save().then(function(){t.close()},function(e){t.dismiss(e)}))},e.cancel=function(){t.dismiss()}}]).controller("AccountProfilePasswordModalController",["$scope","$modalInstance","FireAuth","profile",function(e,t,a,o){e.forms={accountPassword:{}};angular.copy(e.model={accountPassword:{oldPassword:"",newPassword:"",sameNewPassword:""}});e.submit=function(){e.forms.accountPassword.$valid&&(e.httpRequestPromise=a.$changePassword({email:o.email,oldPassword:e.model.accountPassword.oldPassword,newPassword:e.model.accountPassword.newPassword}).then(function(){t.close()},function(e){t.dismiss(e)}))},e.cancel=function(){t.dismiss()}}]).controller("AccountProfileEmailModalController",["$q","$scope","$modalInstance","FireAuth","profile",function(e,t,a,o,i){t.forms={emailAccount:{}};var r=angular.copy(t.model={emailAccount:{newEmail:"",password:""}});t.submit=function(){if(t.forms.emailAccount.$valid){var r=e.defer();t.httpRequestPromise=r.promise,o.$changeEmail({password:t.model.emailAccount.password,newEmail:t.model.emailAccount.newEmail,oldEmail:i.email}).then(function(){return i.email=t.model.emailAccount.newEmail,i.$save()}).then(function(){a.close(),r.resolve()},function(e){a.dismiss(e),r.reject(e)})}},t.resetForm=function(){angular.copy(r.emailAccount,t.model.emailAccount),t.forms.emailAccount.$setUntouched(),t.forms.emailAccount.$setPristine()},t.cancel=function(){a.dismiss()}}]);