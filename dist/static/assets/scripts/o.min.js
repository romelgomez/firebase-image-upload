"use strict";angular.module("app",["angular-loading-bar","filters","validators","firebase","fire2","routes","tree","publications","login","account","ui.bootstrap","main","updateMeta","accountPublications"]).controller("AppController",["$scope","FireAuth",function(e,t){t.$onAuthStateChanged(function(t){e.firebaseUser=t}),e.logout=function(){t.$signOut()},e.inProduction=!1,e.sizeOf=function(e){return"undefined"==typeof e&&(e={}),Object.keys(e).length},e.firstObj=function(e){for(var t in e)if(e.hasOwnProperty(t))return t}}]).directive("facebook",["$window",function(e){return{restrict:"E",scope:{url:"="},template:'<div class="fb-like" data-href="{{url}}" data-layout="button_count" data-action="like" data-show-faces="true" data-share="true"></div>',link:function(t){"undefined"!=typeof e.FB&&t.$watch(function(e){return e.url},function(){e.FB.XFBML.parse()})}}}]),angular.module("main",[]).controller("MainController",["$scope","$q",function(e,t){e.lording={deferred:t.defer(),isDone:!1,promises:[]},e.lording.promise=e.lording.deferred.promise}]).directive("inputFocus",[function(){return{restrict:"A",link:function(e,t){t.focus()}}}]),angular.module("filters",[]).filter("trim",function(){return function(e){return angular.isString(e)?e.replace(/^\s+|\s+$/g,""):e}}).filter("capitalize",[function(){return function(e){return e?e.replace(/([^\W_]+[^\s-]*) */g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}):""}}]).directive("capitalize",["$filter",function(e){return{require:"ngModel",link:function(t,o,i,n){n.$parsers.push(function(t){var o=e("capitalize")(t);return o!=t&&(n.$setViewValue(o),n.$render()),o})}}}]).filter("slug",[function(){return function(e){return e?String(e).toLowerCase().replace(/[^a-zá-źA-ZÁ-Ź0-9]/g," ").trim().replace(/\s{2,}/g," ").replace(/\s+/g,"-"):""}}]).filter("noSpecialChars",[function(){return function(e){return e?String(e).replace(/[^a-zá-źA-ZÁ-Ź0-9]/g," ").trim().replace(/\s{2,}/g," "):""}}]).filter("capitalizeFirstChar",[function(){return function(e){return e?e.trim().replace(/(^\w?)/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1)}):""}}]).directive("capitalizeFirstChar",["$filter",function(e){return{require:"ngModel",link:function(t,o,i,n){n.$parsers.push(function(t){var o=e("capitalizeFirstChar")(t);return o!=t&&(n.$setViewValue(o),n.$render()),o})}}}]).filter("dateParse",["$window","$filter",function(e,t){return function(o,i,n){return o?t("date")(e.Date.parse(o),i,n):""}}]).filter("stringReplace",[function(){return function(e,t,o){return e.split(t).join(o)}}]).filter("reverse",[function(){return function(e){return angular.isArray(e)?e.slice().reverse():[]}}]).filter("camelCase",[function(){return function(e){return e?e.trim().replace(/(?:^\w|[A-Z]|\b\w|\s+)/g,function(e,t){return 0===+e?"":0===t?e.toLowerCase():e.toUpperCase()}):""}}]).directive("camelCase",["$filter",function(e){return{require:"ngModel",link:function(t,o,i,n){n.$parsers.push(function(t){var o=e("camelCase")(t);return o!=t&&(n.$setViewValue(o),n.$render()),o})}}}]).filter("lispCaseToCamelCase",[function(){return function(e){return e?e.trim().replace(/[\-_](\w)/g,function(e){return e.charAt(1).toUpperCase()}):""}}]).filter("bytes",[function(){return function(e,t){if(isNaN(parseFloat(e))||!isFinite(e))return"-";"undefined"==typeof t&&(t=1);var o=["bytes","kB","MB","GB","TB","PB"],i=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,Math.floor(i))).toFixed(t)+" "+o[i]}}]).filter("htmlToPlaintext",[function(){return function(e){return e?String(e).replace(/<[^>]+>/gm," ").trim():""}}]).filter("unsafe",["$sce",function(e){return e.trustAsHtml}]).filter("removeFileExtension",["$filter",function(e){return function(t){return t?e("stringReplace")(t,"."+t.split(".").pop(),"").trim():""}}]).filter("lodashJoin",["$window",function(e){return function(t,o){return t?e._.join(t,o).trim():""}}]),angular.module("validators",[]).directive("noSpecialChars",function(){return{restrict:"A",require:"ngModel",link:function(e,t,o,i){i.$validators.noSpecialChars=function(e){return String(e).match(/[^a-zá-źA-ZÁ-Ź0-9\s]/g)?!1:!0}}}}),angular.module("fire2",["firebase"]).constant("FIRE_BASE_CONFIG",{apiKey:"AIzaSyBAuBLwxWaynoLI6AQeR60k9xPG5JnIgTA",authDomain:"berlin.firebaseapp.com",databaseURL:"https://berlin.firebaseio.com",storageBucket:"project-966415674961578791.appspot.com"}).config(["FIRE_BASE_CONFIG",function(e){firebase.initializeApp(e)}]).factory("FireAuth",["$firebaseAuth",function(e){return e()}]).factory("FireRef",["$window",function(e){return e.firebase.database().ref()}]),angular.module("routes",["ngRoute"]).constant("SECURED_ROUTES",{}).constant("LOGIN_REDIRECT_PATH","/login").config(["$routeProvider","SECURED_ROUTES",function(e,t){e.whenAuthenticated=function(o,i){return i.resolve=i.resolve||{},i.resolve.user=["FireAuth",function(e){return e.$requireSignIn()}],e.when(o,i),t[o]=!0,e}}]).config(["$routeProvider","$locationProvider",function(e,t){t.html5Mode(!0).hashPrefix("!"),e.when("/",{templateUrl:"static/assets/views/main.html",controller:"MainController"}).whenAuthenticated("/categories",{templateUrl:"static/assets/views/categories.html",controller:"TreeController"}).whenAuthenticated("/locations",{templateUrl:"static/assets/views/locations.html",controller:"TreeController"}).whenAuthenticated("/j-tree-test",{templateUrl:"static/assets/views/jtree-diretive-test.html",controller:"TreeController"}).whenAuthenticated("/new-publication",{templateUrl:"static/assets/views/publication.html",controller:"PublicationsController"}).whenAuthenticated("/edit-publication/:publicationId",{templateUrl:"static/assets/views/publication.html",controller:"PublicationsController"}).when("/view-publication/:publicationID/:title",{templateUrl:"static/assets/views/viewPublication.html",controller:"ViewPublicationController"}).when("/all-publications-of/:userID/:pseudonymOrNames",{templateUrl:"static/assets/views/viewAllPublication.html",controller:"ViewAllPublicationController"}).when("/login",{templateUrl:"static/assets/views/login.html",controller:"LoginController"}).whenAuthenticated("/account",{templateUrl:"static/assets/views/account.html",controller:"AccountController"}).when("/:accountName/:categoriesAndLocations/:publicationID/:title",{templateUrl:"static/assets/views/viewPublication.html",controller:"ViewPublicationController"}).when("/:accountName",{templateUrl:"static/assets/views/accountPublications.html",controller:"AccountPublicationsController"}).otherwise({redirectTo:"/"})}]).run(["$rootScope","$location","FireAuth","SECURED_ROUTES","LOGIN_REDIRECT_PATH",function(e,t,o,i,n){o.$onAuthStateChanged(function(e){!e&&i.hasOwnProperty(t.path())&&t.path(n)}),e.$on("$routeChangeError",function(e,o,i,a){"AUTH_REQUIRED"===a.toString()&&t.path(n)})}]),angular.module("tree",["ngMessages","cgBusy","jlareau.pnotify"]).factory("treeService",["$filter",function(e){return{getPath:function(t,o){var i=[],n=e("reverse")(o),a=function(e){angular.forEach(n,function(t){e===t.$id&&(i.push(t),""!==t.parentId&&a(t.parentId))})};return a(t),e("reverse")(i)},pathNames:function(e){var t=[];return angular.forEach(e,function(e){t.push(e.name)}),t}}}]).controller("TreeController",["$scope","$location","user",function(e,t,o){"facebook:10204911533563856"!==o.uid&&t.path("/")}]).controller("EditNodeController",["$scope","$q","$uibModalInstance","node","nodeRef",function(e,t,o,i,n){function a(e){var o=t.defer(),i=o.promise;return n.update({name:e.name},function(e){e?o.reject(e):o.resolve()}),i}e.model={name:i.name,id:i.id},e.confirm=function(){e.editNodeForm.$valid&&(e.httpRequestPromise=a(e.model).then(function(){o.close()},function(e){o.dismiss(e)}))},e.cancel=function(){o.dismiss("The editing is been canceled")}}]).controller("DeleteNodeController",["$scope","$uibModalInstance","node",function(e,t,o){e.node=o,e.branchCheckBox=e.node.left+1!==e.node.right,e.model={branch:null},e.confirm=function(){t.close({node:o,branch:e.model.branch})},e.cancel=function(){t.dismiss("Delete action has be cancel")}}]).directive("jTree",["$q","$templateCache","$compile","$uibModal","FireRef","$firebaseArray","$firebaseObject","notificationService","$log",function(e,t,o,i,n,a,r,l,s){function c(t){var o=e.defer(),i=n.child($);return i.set(t,function(e){e?o.reject(e):o.resolve()}),o.promise}function u(e){var t={},o=function(e){angular.forEach(e,function(e){t[e.id]={},t[e.id].name=e.name,t[e.id].parentId=e.parentId,t[e.id].left=e.left,t[e.id].right=e.right,e.children.length>0&&o(e.children)})};return o(e),t}function d(e){var t,o=function(e,i){angular.forEach(e,function(e){t||(t=1),e.left=t,t+=1,i?e.parentId=i:e.parentId="",void 0!==e.children&&e.children.length>=1?o(e.children,e.id):e.children=[],e.right=t,t+=1})};o(e)}function f(e,t,o){var i={targetTree:[],recordsIdsForDelete:[]},n=function(e){var t=[];t.push(e.id);var o=function(e){angular.forEach(e,function(e){t.push(e.id),e.children.length>0&&o(e.children)})};return o(e.children),t},a=function(e){angular.forEach(e,function(e){if(e.id===t)if(e.children.length>0)if(o===!0)i.recordsIdsForDelete=n(e);else{if(i.recordsIdsForDelete.push(e.id),""===e.parentId)for(var r=0;r<e.children.length;r++)e.children[r].parentId="";else for(var l=0;l<e.children.length;l++)e.children[l].parentId=e.parentId;a(e.children)}else i.recordsIdsForDelete.push(e.id);else{var s={id:e.id,parentId:e.parentId,name:e.label,left:e.left,right:e.right,children:[]};""!==e.parentId?m(i.targetTree,s):i.targetTree.push(s),void 0!==e.children&&a(e.children)}})};return a(e),i}function p(e){var t={};return t.id=e.$id,t.label=e.name,t.parentId=e.parentId,t.left=parseInt(e.left),t.right=parseInt(e.right),t.children=[],t}function m(e,t){angular.forEach(e,function(e){e.id===t.parentId?e.children.push(t):e.children.length>0&&m(e.children,t)})}function g(e){var t=[];return angular.forEach(e,function(e){var o=p(e);""!==o.parentId?m(t,o):t.push(o)}),t}function h(e,t){var o={dragAndDrop:!0,selectable:!0,autoEscape:!1,autoOpen:!1,data:t};e.tree(o)}function b(e,t){e.tree("loadData",t)}var v={rawNodes:[]},y={},$="";return{restrict:"E",template:'<section cg-busy="{promise:httpRequestPromise,message:\'Just a moment\'}"><section><div class="panel panel-default"><div class="panel-heading"><h3 class="panel-title">New node</h3></div><div class="panel-body" ><form id="nodeForm" name="nodeForm" novalidate="" ng-submit="nodeFormSettings.submitForm()"><div class="form-group"><label>New node</label><input type="text" name="node" ng-model="nodeFormSettings.model.nodeName" required class="form-control" placeholder="" tabindex="1"><div data-ng-messages="nodeForm.$submitted && nodeForm.node.$error" class="help-block"><div data-ng-message="required">- The <b>node</b> name is required.</div><div data-ng-message="noSpecialChars">- The <b>node</b> name must not have special characters.</div></div></div></form></div><div class="panel-footer"><button form="nodeForm" class="btn btn-primary" type="submit">Send</button> <button class="btn btn-warning" ng-click="nodeFormSettings.resetForm()">Cancel</button></div></div></section><section><div class="panel panel-default"><div class="panel-heading"><h3 class="panel-title" style="line-height: 30px;">The <b>{{reference | capitalize}}</b> tree data:<div class="btn-group pull-right" role="group" aria-label="..." ng-show="nodeSelected.status"><button ng-click="editNode(nodeSelected.node)" type="button" class="btn btn-info">Edit</button><button ng-click="deleteNode(nodeSelected.node)" type="button" class="btn btn-danger">Delete</button></div></h3></div><div class="panel-body"><div ng-show="rawUnsortedNodes.$value === null">Start add some data.</div><div id="tree"></div><div/><div/></section><section><div class="panel panel-default"><div class="panel-heading"><h3 class="panel-title" style="line-height: 30px;">The <b>{{reference | capitalize}}</b> tree <b>Raw Unsorted Nodes</b> data: </h3></div><div class="panel-body"><div><div class="alert alert-danger" role="alert"> For recovering purposes, after any changes, update the node service at code level, to avoid lost of this critical data.</div></div><pre>{{rawUnsortedNodes | json }}</pre><div/><div/></section><section/>',scope:{reference:"@"},link:function(e,t){if("undefined"==typeof e.reference)throw">>> The reference attr is undefined >>>";$=e.reference;var o=t.find("#tree");h(o,[]),o.bind("tree.move",function(t){t.preventDefault(),t.move_info.do_move();var i=angular.fromJson(o.tree("toJson"));d(i);var n=u(i);e.httpRequestPromise=c(n).then(function(){e.nodeSelected={},l.success("The tree or nodes has been update")},function(e){l.error(e)})}),o.bind("tree.select",function(t){var o={status:!1,$node:{}};null!==t.node&&(o.node=t.node,o.status=!0),e.nodeSelected=o,y=o,e.$apply()}),e.editNode=function(t){var o=i.open({template:'<div class="modal-header"><h3 class="modal-title">Edit node:</h3></div><div class="modal-body" cg-busy="{promise:httpRequestPromise,message:\'Just a moment\'}"><h3 class="text-danger" style="margin-top: 0; margin-bottom: 0;">{{node.name | capitalizeFirstChar}}</h3><form id="editNodeForm" name="editNodeForm" novalidate="" ng-submit="confirm()"><div class="form-group"><label>Node name</label><input type="text" name="node" ng-model="model.name" required no-special-chars class="form-control" placeholder="" tabindex="1"><div data-ng-messages="editNodeForm.$submitted && editNodeForm.node.$error" class="help-block"><div data-ng-message="required">- The <b>node</b> name is required.</div><div data-ng-message="noSpecialChars">- La <b>node</b> name must not have special characters.</div></div></div></form></div><div class="modal-footer"><button class="btn btn-warning" ng-click="cancel()">Cancel</button><button form="editNodeForm" class="btn btn-primary" type="submit">Confirm</button></div>',controller:"EditNodeController",resolve:{node:function(){return t},nodeRef:function(){return n.child(e.reference).child(t.id)}}});o.result.then(function(){e.nodeSelected={},l.success("It was updated successfully.")},function(e){l.error(e)})},e.deleteNode=function(t){var o=i.open({template:'<div class="modal-header"><h3 class="modal-title">Do you really want to delete this node?</h3></div><div class="modal-body"><h3 class="text-danger" style="margin-top: 0; margin-bottom: 0;">{{node.name | capitalizeFirstChar}}</h3><form id="deleteBranchForm" name="deleteBranchForm" novalidate="" ng-submit="confirm()"><div ng-show="branchCheckBox"><div class="checkbox"><label><input type="checkbox" name="branch" ng-model="model.branch" value="">And daughters nodes to.</label></div></div></form></div><div class="modal-footer"><button class="btn btn-warning" ng-click="cancel()">Cancel</button><button form="deleteBranchForm" class="btn btn-primary" type="submit">Confirm</button></div>',controller:"DeleteNodeController",resolve:{node:function(){return t}}});o.result.then(function(t){e.nodeSelected={};var o=f(g(v.rawNodes),t.node.id,t.branch);d(o.targetTree);var i=u(o.targetTree);e.httpRequestPromise=c(i).then(function(){l.success("The tree or nodes has been update")},function(e){l.error(e)})},function(e){l.error(e)})},e.nodeFormSettings={model:{nodeName:""},submitForm:function(){if(e.nodeForm.$valid){var t,o,i=v.rawNodes.length;if(i>=1){var n=2*i;t=n+1,o=n+2}else t=1,o=2;var a={left:t,right:o,parentId:"",name:e.nodeFormSettings.model.nodeName};e.httpRequestPromise=v.rawNodes.$add(a).then(function(){e.nodeSelected={},l.success("Data has been saved."),e.nodeFormSettings.resetForm()},function(e){l.error(e)})}},resetForm:function(){e.nodeFormSettings.model=angular.copy(e.nodeFormSettings.modelCopy),e.nodeForm.$setUntouched(),e.nodeForm.$setPristine()}},e.nodeFormSettings.modelCopy=angular.copy(e.nodeFormSettings.model),v.rawNodes=a(n.child(e.reference).orderByChild("left")),e.rawUnsortedNodes=r(n.child(e.reference)),e.httpRequestPromise=v.rawNodes.$loaded(null,function(e){l.error(e)}),v.rawNodes.$watch(function(){b(o,g(v.rawNodes))})}}}]);var publicationsModule=angular.module("publications",["uuid","ngMessages","angular-redactor","ngFileUpload","cloudinary","algoliasearch","images"]).factory("publicationService",["$q","$window","FireRef","imagesService",function(e,t,o,i){function n(t,i){var n=e.defer(),a=o.child("users").child(t).child("publicationsCount");return a.once("value",function(e){var t;t=e.exists()?e.val():0,"undefined"!=typeof i&&i===!0?t+=1:t-=1,a.set(t).then(function(){n.resolve()},function(e){n.reject(e)})}),n.promise}var a=o.child("publications");return{savePublication:function(o,i,r){var l=e.defer();if(angular.isDefined(i)&&""!==i){var s=a.child(i);delete o.releaseDate,delete o.images,s.update(o,function(e){e?l.reject(e):l.resolve({publicationId:i})})}else{var c=a.push();o.releaseDate=t.firebase.database.ServerValue.TIMESTAMP,c.set(o).then(function(){return n(r,!0)}).then(function(){l.resolve({publicationId:c.key})},function(e){l.reject(e)})}return l.promise},removePublication:function(t,o){var r=e.defer(),l=[];return l.push(i.deleteImages(t,null)),l.push(a.child(t).remove()),l.push(n(o)),e.all(l).then(function(){r.resolve()},function(e){notificationService.error(e)}),r.promise},saveFilesData:function(t,o){var i=e.defer(),n=a.child(t).child("images"),r=[];return angular.forEach(o,function(e,t){r.push(n.child(t).set(e))}),e.all(r).then(function(){i.resolve()}),i.promise},loadPublication:function(t,o){var i=e.defer();return a.child(o).once("value",function(e){var o=e.val();e.exists()?t===o.userID?i.resolve({publication:o}):i.reject("401"):i.reject("404")}),i.promise}}}]).controller("PublicationsController",["$scope","$q","$window","$filter","$routeParams","$location","$http","FireRef","$firebaseArray","$firebaseObject","rfc4122","treeService","notificationService","Upload","user","$uibModal","publicationService","imagesService","$log",function(e,t,o,i,n,a,r,l,s,c,u,d,f,p,m,g,h,b,v){function y(o){var i=t.defer();return h.loadPublication(m.uid,o).then(function(t){angular.forEach(t.publication,function(t,o){"releaseDate"!==o&&(e.publication.model[o]=t)})}).then(function(){e.publication.images=[],angular.forEach(e.publication.model.images,function(t,o){t.$id=o,t.$ngfWidth=t.width,t.$ngfHeight=t.height,t.size="undefined"!=typeof t.size?t.size:t.bytes,t.isUploaded=!0,t.name="undefined"!=typeof t.name?t.name:t.original_filename+"."+t.format,e.publication.images.push(t)})}).then(function(){e.publication.$id=o,e.publication.categoryPath=d.getPath(e.publication.model.categoryId,e.publication.categories),e.publication.categoryPath.length>0?e.publication.categorySelected=!0:(e.publication.redefineCategory=!0,e.publication.categorySelected=!1,e.publication.model.categoryId=""),e.publication.locationPath=d.getPath(e.publication.model.locationId,e.publication.locations),0===e.publication.locationPath.length&&(e.publication.redefineLocation=!0,e.publication.model.locationId=""),e.publication.inEditMode=!0,i.resolve()},function(e){a.path("/"),i.reject(e)}),i.promise}var $=t.defer();e.httpRequestPromise=$.promise,e.publication={$id:"",categoryPath:[],locationPath:[],categorySelected:!1,inEditMode:!1,isReady:!1,model:{userID:m.uid,categoryId:"",locationId:"",featuredImageId:"",department:"",title:"",htmlDescription:"",barcode:"",barcodeType:"CODE128"}};var w=t.defer(),I=t.defer(),P=s(l.child("categories").orderByChild("left"));P.$loaded().then(function(){e.publication.categories=angular.copy(P),w.resolve(),P.$destroy()},function(e){$.reject(e)});var S=s(l.child("locations").orderByChild("left"));S.$loaded().then(function(){e.publication.locations=angular.copy(S),I.resolve(),S.$destroy()},function(e){$.reject(e)}),t.all([w.promise,I.promise]).then(function(){return angular.isDefined(n.publicationId)?y(n.publicationId):void(e.publication.images=[])}).then(function(){e.publication.isReady=!0,$.resolve()}),e.submit=function(){if(e.publicationForm.$valid){var o=t.defer();h.savePublication(e.publication.model,e.publication.$id,m.uid).then(function(t){return e.publication.$id=""!==e.publication.$id?e.publication.$id:t.publicationId,b.uploadFiles(e.publication.images,e.publication.$id)}).then(function(t){return h.saveFilesData(e.publication.$id,t)}).then(function(){f.success("Data has been save"),o.resolve()},function(e){f.error(e),o.reject(e)}),e.httpRequestPromise=o.promise}else f.error("Something is missing")},e.discard=function(){console.log(""!==e.publication.model.title&&void 0!==e.publication.model.title?e.publication.model.title:"Untitled");var t=g.open({templateUrl:"discardPublication.html",controller:"DiscardPublicationController",resolve:{publicationId:function(){return""!==e.publication.$id},title:function(){return""!==e.publication.model.title&&void 0!==e.publication.model.title?e.publication.model.title:"Untitled"}}});t.result.then(function(){""!==e.publication.$id?e.httpRequestPromise=h.removePublication(e.publication.$id,m.uid).then(function(){f.success("The publication has been deleted."),a.path("/")}):(f.success("The publication has been discard."),a.path("/"))},function(e){f.error(e)})}}]).controller("DiscardPublicationController",["$scope","$uibModalInstance","publicationId","title",function(e,t,o,i){e.publication={$id:o,title:i},e.confirm=function(){t.close()},e.cancel=function(){t.dismiss("This has be cancel")}}]).directive("locationInput",["treeService",function(e){return{scope:{formName:"=",locations:"=",model:"=",redefineLocation:"=",locationPath:"="},template:'<div><hr class="hr-xs"><label class="control-label"><i class="fa fa-map-marker"></i> Location <sup style="color: red;">*</sup></label><div class="list-group" style="margin-bottom: 0"><button type="button" class="list-group-item" ng-click="setLocation(location.$id); publication.redefineLocation = false;" ng-repeat="location in locations | filter:{parentId: model.locationId}:true" ><i style="color: #286090" class="fa fa-folder"></i> {{location.name | capitalizeFirstChar}}</button></div><ol ng-show="locationPath.length > 0" class="breadcrumb" style="margin-bottom: 0; margin-top: 10px;"><li ng-click="model.locationId =\'\'; locationPath =[];" class="a-link"> Reset </li><li ng-repeat="location in locationPath" ng-click="setLocation(location.$id)" ng-class="{\'a-link\': !$last}"> {{location.name | capitalizeFirstChar}} </li></ol><input name="location" ng-model="model.locationId" required class="form-control" placeholder="" type="text" style="display: none;"><div data-ng-messages="formName.$submitted && formName.location.$error" class="help-block"><div data-ng-message="required" >- The <b>Location</b> is required.</div></div><div ng-show="formName.redefineLocation === true" class="alert alert-danger alert-xs" style="margin-bottom: 10px;" role="alert"><b>NOTE: Sorry, but we need to redefine the location.</b></div><div class="alert alert-info alert-xs" style="margin-bottom: 0; margin-top: 10px;" role="alert">NOTE: Select the <b>location</b> that best suits to the publication. No matter if it is too general or specific, the important thing is to select one.</div></div>',link:function(t){t.setLocation=function(o){t.model.locationId=o,t.locationPath=e.getPath(o,t.locations),t.model.locations=e.pathNames(t.locationPath)}}}}]).directive("categorySelector",["treeService",function(e){return{restrict:"E",scope:{categoryPath:"=",categorySelected:"=",isReady:"=",inEditMode:"=",model:"=",categories:"=",redefineCategory:"="},template:'<div class="panel panel-default" ng-show="categorySelected === false && isReady"><div class="panel-heading"><h3 class="panel-title" ng-switch="inEditMode"><span ng-switch-when="false" >New Publication - Select a category:</span><span ng-switch-when="true">Edit Publication</span></h3></div><div class="list-group"><button type="button" class="list-group-item" ng-click="setCategory(category.$id)" ng-repeat="category in categories | filter:{parentId: model.categoryId}:true" ><i style="color: #286090" class="fa" ng-class="{\'fa-folder\': (category.name !== \'Marketplace\' && category.name !== \'Jobs\' && category.name !== \'Real Estate\' && category.name !== \'Transport\' && category.name !== \'Services\') , \'fa-shopping-cart\': (category.name === \'Marketplace\') , \'fa-suitcase\': (category.name === \'Jobs\'), \'fa-home\': (category.name === \'Real Estate\'), \'fa-car\': (category.name === \'Transport\'), \'fa-wrench\' : (category.name === \'Services\')}"></i> {{category.name | capitalizeFirstChar}}</button></div><div class="panel-body"><ol ng-show="categoryPath.length > 0" class="breadcrumb" style="margin-bottom: 7px;"><li ng-click="model.categoryId = \'\'; categoryPath =[];" class="a-link"> Reset </li><li ng-repeat="category in categoryPath" ng-click="setCategory(category.$id)" ng-class="{\'a-link\': !$last}"> {{category.name | capitalizeFirstChar}} </li></ol><div ng-show="redefineCategory === true" class="alert alert-danger alert-xs" style="margin-bottom: 10px;" role="alert"><b>NOTE: Sorry, but we need to redefine the category.</b></div><div class="alert alert-info alert-xs" style="margin-bottom: 0;" role="alert">NOTE: Select the category that best suits to the publication. No matter if it is too general or specific, the important thing is to select one.</div></div><div class="panel-footer" style="text-align: right;"><button ng-click="categorySelected = true; redefineCategory = false" type="button" class="btn btn-primary" ng-disabled="model.categoryId ===\'\'" ><i class="fa fa-check"></i> Confirm selection</button></div></div>',link:function(t){t.setCategory=function(o){t.model.categoryId=o,t.categoryPath=e.getPath(o,t.categories),t.model.categories=e.pathNames(t.categoryPath),t.model.department=t.categoryPath[0]?t.categoryPath[0].name:""}}}}]).directive("descriptionInput",["$filter",function(e){return{restrict:"E",scope:{formName:"=",model:"="},template:'<div class="form-group"><label class="control-label"><span class="glyphicon glyphicon-book"></span> Description <sup style="color: red;">*</sup></label><textarea redactor name="htmlDescription" data-ng-model="model.htmlDescription" required class="form-control" placeholder=""></textarea><div data-ng-messages="formName.$submitted && formName.htmlDescription.$error" class="help-block"><div data-ng-message="required" >- The <b>description</b> is required.</div></div></div>',link:function(t){t.$watch(function(e){return e.model.htmlDescription},function(){t.model.description=e("htmlToPlaintext")(t.model.htmlDescription)})}}}]).directive("warrantyInput",["$filter",function(e){return{restrict:"E",scope:{formName:"=",model:"="},template:'<div class="form-group"><label class="control-label"><i class="fa fa-certificate"></i> Warranty <sup style="color: red;">*</sup></label><textarea redactor name="htmlWarranty" data-ng-model="model.htmlWarranty" required class="form-control" placeholder=""></textarea><div data-ng-messages="formName.$submitted && formName.htmlWarranty.$error" class="help-block"><div data-ng-message="required" >- The <b>Warranty</b> is required.</div></div></div>',link:function(t){t.$watch(function(e){return e.model.htmlWarranty},function(){t.model.warranty=e("htmlToPlaintext")(t.model.htmlWarranty)})}}}]).directive("titleInput",["$filter",function(e){return{restrict:"E",scope:{formName:"=",model:"="},template:'<div class="form-group"><label class="control-label"><span class="glyphicon glyphicon-bookmark"></span> Title <sup style="color: red;">*</sup></label><input type="text" name="title" ng-model="model.title" required minlength="7" capitalize-first-char class="form-control" placeholder=""><div data-ng-messages="formName.$submitted && formName.title.$error" class="help-block"><div data-ng-message="required">- The <b>title</b> is required.</div><div data-ng-message="minlength" >- The <b>title</b> must be at least 7 characters long.</div></div></div>'}}]).directive("quantityInput",[function(){return{restrict:"E",scope:{formName:"=",model:"="},template:'<div class="form-group" ><div class="row"><div class="col-xs-12 col-sm-12 col-md-5"><label class="control-label"><i class="fa fa-cubes"></i> Quantity in stock <sup style="color: red;">*</sup></label><div class="input-group"><div class="input-group-addon">Units</div><input name="quantity" ng-model="model.quantity" required class="form-control" placeholder="Eje: 100" type="number"></div><div data-ng-messages="formName.$submitted && formName.quantity.$error" class="help-block"><div data-ng-message="required">- The <b>quantity</b> is required.</div></div></div></div></div>'}}]).directive("priceInput",[function(){return{restrict:"E",scope:{formName:"=",model:"="},template:'<div class="form-group" ><div class="row"><div class="col-xs-12 col-sm-12 col-md-5"><label class="control-label"><span class="glyphicon glyphicon-tag"></span> Price <sup style="color: red;">*</sup></label><div class="input-group"><div class="input-group-addon">£</div><input name="price" ng-model="model.price" required class="form-control" placeholder="Eje: 1000" type="number"></div><div data-ng-messages="formName.$submitted && formName.price.$error" class="help-block"><div data-ng-message="required">- The <b>price</b> is required.</div></div></div></div></div>'}}]).directive("jobTypeSelect",[function(){return{restrict:"E",scope:{model:"="},template:'<hr class="hr-xs"><label><i class="fa fa-random"></i> Job type</label><div class="row" style="margin-bottom: 10px;"><div class="col-xs-12 col-sm-12 col-md-5"><select class="form-control" ng-model="model.jobType"><option ng-repeat="type in jobTypes" value="{{type}}">{{type}}</option></select></div></div>',link:function(e){"undefined"==typeof e.model.jobType&&(e.model.jobType="Permanent"),e.jobTypes=["Permanent","Contract"]}}}]).directive("salaryInput",[function(){return{restrict:"E",scope:{formName:"=",model:"="},template:'<hr class="hr-xs"><div class="row"><div class="col-xs-12 col-sm-12 col-md-5"><label><i class="fa fa-gbp"></i> Salary</label><div style="margin-bottom: 10px;"><select class="form-control" ng-model="model.jobSalaryType"><option ng-repeat="salaryType in jobSalaryTypes" value="{{salaryType}}"> {{salaryType}} </option></select></div><label><i class="fa fa-gbp"></i> From:</label><div class="form-group" style="margin-bottom: 10px;"><input name="jobSalaryStartAt" ng-model="model.jobSalaryStartAt" required class="form-control" placeholder="<Base salary or start at>" type="number"></div><div data-ng-messages="(formName.$submitted && formName.jobSalaryStartAt.$error) || (formName.jobSalaryStartAt.$dirty && formName.jobSalaryStartAt.$error)" class="help-block"><div data-ng-message="required">- The <b>start or base salary</b> is required.</div></div><label><i class="fa fa-gbp"></i> To:</label><div class="form-group" style="margin-bottom: 10px;"><input name="jobSalaryEndAt" ng-model="model.jobSalaryEndAt" required class="form-control" placeholder="<End at>" type="number"></div><div data-ng-messages="(formName.$submitted && formName.jobSalaryEndAt.$error) || (formName.jobSalaryEndAt.$dirty && formName.jobSalaryEndAt.$error)" class="help-block"><div data-ng-message="required">- The <b> max salary </b> is required.</div></div><div class="checkbox"><label><input ng-model="model.jobHasBonus" type="checkbox"> The job Has Bonus?</label></div><div class="checkbox" style="margin-bottom: 0;"><label><input ng-model="model.jobHasBenefits" type="checkbox"> The job Has Benefits?</label></div></div></div>',link:function(e){function t(){switch(e.model.jobSalaryType){case"Annual":e.model.jobEstimatedMonthlySalary=e.model.jobSalaryStartAt/12;break;case"Daily":e.model.jobEstimatedMonthlySalary=21.741*e.model.jobSalaryStartAt;break;case"Hourly":e.model.jobEstimatedMonthlySalary=8*e.model.jobSalaryStartAt*21.741}}"undefined"==typeof e.model.jobSalaryStartAt&&(e.model.jobSalaryStartAt=null),"undefined"==typeof e.model.jobSalaryEndAt&&(e.model.jobSalaryEndAt=null),"undefined"==typeof e.model.jobHasBonus&&(e.model.jobHasBonus=!1),"undefined"==typeof e.model.jobHasBenefits&&(e.model.jobHasBenefits=!1),"undefined"==typeof e.model.jobSalaryType&&(e.model.jobSalaryType="Annual"),e.jobSalaryTypes=["Annual","Daily","Hourly"],
e.$watch(function(e){return e.model.jobSalaryType},function(){t()}),e.$watch(function(e){return e.model.jobSalaryStartAt},function(){t()})}}}]).directive("recruiterTypesSelect",[function(){return{restrict:"E",scope:{model:"="},template:'<hr class="hr-xs"><label><i class="fa fa-random"></i> Recruiter type</label><div class="row" style="margin-bottom: 10px;"><div class="col-xs-12 col-sm-12 col-md-5"><select class="form-control" ng-model="model.jobRecruiterType"><option ng-repeat="type in recruiterTypes" value="{{type}}">{{type}}</option></select></div></div>',link:function(e){"undefined"==typeof e.model.jobRecruiterType&&(e.model.jobRecruiterType="Agency"),e.recruiterTypes=["Agency","Direct Employer"]}}}]).directive("reHomeStatus",[function(){return{restrict:"E",scope:{model:"="},template:'<hr class="hr-xs"><label><i class="fa fa-random"></i> Home status</label><div class="row" style="margin-bottom: 10px;"><div class="col-xs-12 col-sm-12 col-md-5"><select class="form-control" ng-model="model.reHomeStatus"><option ng-repeat="option in options" value="{{option}}">{{option}}</option></select></div></div>',link:function(e){"undefined"==typeof e.model.reHomeStatus&&(e.model.reHomeStatus="New"),e.options=["New","Refurbished","Used"]}}}]).directive("reHomeFor",[function(){return{restrict:"E",scope:{model:"="},template:'<hr class="hr-xs"><label><i class="fa fa-random"></i> Home for</label><div class="row" style="margin-bottom: 10px;"><div class="col-xs-12 col-sm-12 col-md-5"><select class="form-control" ng-model="model.reHomeFor"><option ng-repeat="option in options" value="{{option}}">{{option}}</option></select></div></div>',link:function(e){"undefined"==typeof e.model.reHomeFor&&(e.model.reHomeFor="Sale"),e.options=["Sale","Rent"]}}}]);publicationsModule.controller("ViewPublicationController",["$scope","$q","$window","$filter","$routeParams","$location","FireRef","$firebaseObject","notificationService",function(e,t,o,i,n,a,r,l,s){function c(e){var o=t.defer();return r.child("publications").child(e).once("value").then(function(e){if(e.exists()){var t=e.val();t.$id=e.key,"undefined"==typeof t.releaseDate?o.reject():o.resolve({publication:t})}else o.reject()},function(e){o.reject(e)}),o.promise}function u(e){var o=t.defer();return r.child("users").child(e).once("value").then(function(e){var t=e.val();t.$id=e.key,o.resolve({profile:t})},function(e){o.reject(e)}),o.promise}if(e.publication={$isReady:!1,data:{},$images:[],$barcode:{string:"",options:{width:1,height:10,quite:10,format:"CODE128",displayValue:!0,font:"monospace",textAlign:"center",fontSize:10,backgroundColor:"",lineColor:"#000"}},$seo:{url:""}},angular.isDefined(n.publicationID)){var d=t.defer();e.httpRequestPromise=d.promise,c(n.publicationID).then(function(t){return e.publication.data=t.publication,e.publication.$barcode.string=t.publication.barcode,angular.forEach(t.publication.images,function(o,i){o.$id=i,i!==t.publication.featuredImageId?e.publication.$images.push(o):e.publication.$images.unshift(o)}),u(t.publication.userID)}).then(function(t){e.profile=t.profile;var n="https://londres.herokuapp.com/",a="",r=o._.join(e.publication.data.categories," "),l=o._.join(e.publication.data.locations," ");a+=r,a+=" in ",a+=l,n+="undefined"!=typeof t.profile.accountName&&""!==t.profile.accountName?t.profile.accountName+"/":t.profile.$id+"/",n+=i("slug")(a)+"/",n+=e.publication.data.$id+"/",n+=i("slug")(e.publication.data.title)+".html",e.publication.$seo.url=n,e.publication.$isReady=!0,d.resolve()},function(){s.error("This action cannot be completed."),a.path("/")})}else s.error("This action cannot be completed."),a.path("/")}]),publicationsModule.controller("ViewAllPublicationController",["$scope","$q","$uibModal",function(e,t,o){e.user={},e.lording={deferred:t.defer(),isDone:!1,promises:[]},e.lording.promise=e.lording.deferred.promise,e.profileImages=function(){console.log("user",e.user)},e.profileImages=function(t){if(angular.isDefined(e.user.profileImages)&&e.user.profileImages.length>0){var i=o.open({templateUrl:"profileImagesModal.html",controller:"ProfileImagesController",size:t,resolve:{profileImages:function(){return e.user.profileImages}}});i.result.then(function(){},function(e){})}else notificationService.error("You have already all the "+item.$id+" inventory compromised.")}}]).controller("ProfileImagesController",["$scope","$uibModalInstance","profileImages",function(e,t,o){e.profileImages=o}]),publicationsModule.directive("barcodeImg",["$compile","$window",function(e,t){function o(){var e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))}return{restrict:"E",scope:{barcodeString:"=",barcodeOptions:"="},link:function(i,n){var a="",r="";o()?(a='<canvas id="barcode-img"></canvas>',r="canvas"):(a='<img id="barcode-img">',r="img"),n.html(e(a)(i)),"undefined"!=typeof i.barcodeString&&("undefined"==typeof i.barcodeOptions&&(i.barcodeOptions={}),i.$watch(function(){return i.barcodeString},function(e){t.JsBarcode(n.find(r),e,i.barcodeOptions)}))}}}]).directive("barcode",["$window",function(e){return{restrict:"A",require:"ngModel",scope:{barcodeOptions:"="},link:function(t,o,i,n){function a(e){r=e}"undefined"==typeof t.barcodeOptions&&(t.barcodeOptions={});var r;n.$validators.barcode=function(o){var i=document.getElementById("barcode-img");return"undefined"==typeof i&&(i=document.createElement("div")),e.JsBarcode(i,o,t.barcodeOptions,a),r}}}}]).directive("barcodeInput",["rfc4122",function(e){return{restrict:"E",scope:{formName:"=",inputModel:"=",selectModel:"="},template:'<hr class="hr-xs"><div class="row"><div class="col-xs-8"><label><i class="fa fa-barcode"></i> Barcode</label><div class="row" style="margin-bottom: 10px;"><div class="col-xs-5"><select class="form-control" ng-model="selectModel" ng-change="formName.barcode.$dirty = true; formName.barcode.$pristine = false; inputModel = \'\';"><option ng-repeat="barcode in barcode.types" value="{{barcode.type}}">{{barcode.title}}</option></select></div><div class="col-xs-5"><button ng-show="selectModel === \'CODE128\'" class="btn btn-default" type="button" ng-click="setBarcodeCODE128Randomly(); formName.barcode.$dirty = true; formName.barcode.$pristine = false;">Set one CODE128 type randomly</button></div></div><div class="form-group" style="margin-bottom: 10px;"><input name="barcode" ng-model="inputModel" required barcode barcode-options="barcode.options" class="form-control" placeholder="<Place here the bar code>" type="text"></div><div data-ng-messages="(formName.$submitted && formName.barcode.$error) || (formName.barcode.$dirty && formName.barcode.$error)" class="help-block"><div data-ng-message="required">- The <b>barcode</b> is required.</div><div data-ng-message="barcode">- The <b>barcode </b> must be valid.</div></div><barcode-img ng-show="!formName.barcode.$error.barcode"></barcode-img></div></div><div class="alert alert-info alert-xs" style="margin-bottom: 0; margin-top: 10px;" role="alert">NOTE: The <b>barcode</b> is obligatory for all type of publications, if you don\'t have one, you can set one CODE128 type randomly, with the barcode you and the clients can track this publication in many ways, and other publications they can maybe have the same barcode.</div>',link:function(t){t.barcode={types:[{title:"EAN (13)",type:"EAN"},{title:"UPC-A",type:"UPC"},{title:"CODE39",type:"CODE39"},{title:"CODE128",type:"CODE128"},{title:"ITF (Interleaved 2 of 5)",type:"ITF"},{title:"ITF14",type:"ITF14"},{title:"Pharmacode",type:"pharmacode"}],options:{width:1,height:50,quite:10,format:"CODE128",displayValue:!0,font:"monospace",textAlign:"center",fontSize:12,backgroundColor:"",lineColor:"#000"}},t.setBarcodeCODE128Randomly=function(){t.inputModel=e.v4()},t.$watch(function(){return t.selectModel},function(e){t.barcode.options.format=e})}}}]),angular.module("images",["uuid"]).factory("imagesService",["$q","$http","$window","rfc4122","Upload",function(e,t,o,i,n){function a(t,o,i){var a=e.defer();return t.upload=n.upload({url:"https://api.cloudinary.com/v1_1/berlin/upload",fields:{public_id:o,upload_preset:"ebdyaimw",context:"alt="+t.name+"|caption="+t.name+"|photo="+t.name,tags:i},file:t}).progress(function(e){t.progress=Math.round(100*e.loaded/e.total)}).success(function(e){t.isUploaded=!0,t.$id=e.public_id,a.resolve(e)}).error(function(e){t.details=e,a.reject()}),a.promise}return{deleteImages:function(o,i){var n=e.defer(),a={tag:o};return"undefined"!=typeof i&&Array.isArray(i)&&(a.public_ids=i),t({method:"DELETE",url:"/files",params:a}).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},uploadFiles:function(t,o){var n={};return angular.forEach(t,function(e){if(!angular.isDefined(e.isUploaded)){var t=i.v4();n[t]=a(e,t,o)}}),e.all(n)},featuredImage:function(t,o,i){var n=e.defer(),a={};return angular.isDefined(i)&&""!==i?a[o]=i:a[o]="",t.update(a).then(function(){n.resolve()}),n.promise},imagesInfo:function(e){var t={inQueue:0,isUploaded:0,invalid:0};return angular.forEach(e,function(e){angular.isDefined(e.isUploaded)||angular.isDefined(e.$error)?angular.isDefined(e.isUploaded)?t.isUploaded+=1:t.invalid+=1:t.inQueue+=1}),t}}}]).directive("uploadImages",["$q","$filter","FireRef","notificationService","imagesService",function(e,t,o,i,n){return{scope:{formName:"=",httpRequestPromise:"=",images:"=",imagesTag:"=",imagesPath:"=",featuredImageId:"=",featuredImageName:"=",featuredImagePath:"="},templateUrl:"static/assets/views/directives/uploadImages.html",link:function(a){a.imagesInfo=function(){return n.imagesInfo(a.images)},a.deleteAllImages=function(e,t){a.httpRequestPromise=n.deleteImages(e,null).then(function(){console.log("never past for here");var e=o.child(t);return e.set({})}).then(function(){angular.copy([],a.images),i.success("The images has been deleted")},function(){i.error("The images cannot be deleted")})},a.setAsPrimaryImage=function(e,t){a.httpRequestPromise=n.featuredImage(o.child(e),a.featuredImageName,t).then(function(){a.featuredImageId=t,i.success("The file as been selected as featured image.")})},a.removeFile=function(r,l,s,c,u){function d(e){a.images=t("filter")(a.images,function(t,o){return o!==e})}if(angular.isDefined(u.isUploaded)){var f=[];if(u.$id===a.featuredImageId){var p=n.featuredImage(o.child(l)).then(function(){a.featuredImageId=""});f.push(p)}var m=n.deleteImages(s,[u.$id]).then(function(){var e=o.child(r).child(u.$id);return e.set({})}).then(function(){d(c)});f.push(m),a.httpRequestPromise=e.all(f).then(function(){i.success("The file as been delete.")},function(e){i.error(e)})}else d(c),i.success("The file as been delete.")},a.removeInvalidFiles=function(){a.images=t("filter")(a.images,function(e){return!angular.isDefined(e.$error)})},a.removeAllQueueFiles=function(){a.images=t("filter")(a.images,function(e){return!(!angular.isDefined(e.isUploaded)&&!angular.isDefined(e.$error))}),i.success("All queue files have been removed.")}}}}]),publicationsModule.directive("listPublications",["$q","$location","$window","algolia","FireRef","$firebaseArray","$firebaseObject","$routeParams","notificationService","$filter","$uibModal",function(e,t,o,i,n,a,r,l,s,c,u){return{restrict:"E",templateUrl:"static/assets/views/directives/publicationsList.html",scope:{profile:"=?",editMode:"=?",lording:"=",account:"=?",submit:"=?",publications:"=?"},link:function(r){function l(){var t=e.defer(),i=o.Object.keys(r.algolia.faceting.currentFacets).length,n=0;return r.algolia.req.facetFilters=[],angular.forEach(r.algolia.faceting.currentFacets,function(e,o){e.length>0&&angular.forEach(e,function(e){r.algolia.req.facetFilters.push(o+":"+e.name)}),n++,i===n&&t.resolve()}),t.promise}function c(){function t(){i.search(r.algolia.req).then(function(e){e.query!==r.algolia.req.query?t():(r.algolia.res=e,d("categories"),d("locations"),o.resolve())},function(e){o.reject(e)})}"undefined"!=typeof r.publications&&(r.publications.more=!1,r.publications.setCount(r.profile.publicationsCount,!0));var o=e.defer(),i=p.initIndex(r.algolia.sortOrder.currentIndexName);return t(),o.promise}function d(e){r.algolia.faceting.facetsAvailables[e]=[],angular.forEach(r.algolia.res.facets[e],function(t,i){angular.forEach(m[e],function(n){if(i===n.name)if(angular.isDefined(r.algolia.faceting.currentFacets[e])&&r.algolia.faceting.currentFacets[e].length>0){var a=o._.last(r.algolia.faceting.currentFacets[e]);n.parentId===a.$id&&(n.count=t,r.algolia.faceting.facetsAvailables[e].push(n))}else""===n.parentId&&(n.count=t,r.algolia.faceting.facetsAvailables[e].push(n))})})}function f(){r.algolia.sortOrder.changeIndexName("publications"),angular.copy({},r.algolia.faceting.currentFacets),r.algolia.req.facetFilters=[],r.algolia.req.page=0,r.algolia.pagination.currentPage=1}r.profile="undefined"!=typeof r.profile?r.profile:{},r.editMode="undefined"!=typeof r.editMode?r.editMode:!1,r.sizeOf=function(e){return"undefined"==typeof e&&(e={}),Object.keys(e).length},r.firstObj=function(e){for(var t in e)if(e.hasOwnProperty(t))return t},"undefined"==typeof r.lording&&(r.lording={deferred:e.defer(),isDone:!1,promises:[]},r.lording.promise=r.lording.deferred.promise);var p=i.Client("FU6V8V2Y6Q","75b635c7c8656803b0b9e82e0510f266"),m={categories:{},locations:{}},g=a(n.child("categories").orderByChild("left")),h=g.$loaded().then(function(){m.categories=angular.copy(g),g.$destroy()});r.lording.promises.push(h);var b=a(n.child("locations").orderByChild("left")),v=b.$loaded().then(function(){m.locations=angular.copy(b),b.$destroy()});r.lording.promises.push(v),r.algolia={isReady:!1,req:{query:"",facets:"*",typoTolerance:!1,facetFilters:[],hitsPerPage:7,getRankingInfo:1,page:0,highlightPreTag:"<b>",highlightPostTag:"</b>"},res:{},pagination:{maxSize:10,currentPage:1,pageChanged:function(){r.algolia.req.page=r.algolia.pagination.currentPage-1,c()}},sortOrder:{currentIndexName:"publications",changeIndexName:function(e){r.algolia.sortOrder.currentIndexName=e},sortBy:function(){r.algolia.req.page=0,r.algolia.pagination.currentPage=1,c()},options:{Marketplace:[{title:"Relevance",indexName:"publications"},{title:"Low prices publications",indexName:"publications_by_price_asc"},{title:"Highest prices publications",indexName:"publications_by_price_desc"},{title:"Latest publications",indexName:"publications_by_releaseDate_desc"},{title:"Old publications",indexName:"publications_by_releaseDate_asc"}],Jobs:[{title:"Relevance",indexName:"publications"},{title:"Highest salary publications",indexName:"publications_by_salary_desc"},{title:"Low salary publications",indexName:"publications_by_salary_asc"},{title:"Latest publications",indexName:"publications_by_releaseDate_desc"},{title:"Old publications",indexName:"publications_by_releaseDate_asc"}],"Real Estate":[{title:"Relevance",indexName:"publications"},{title:"Low prices publications",indexName:"publications_by_price_asc"},{title:"Highest prices publications",indexName:"publications_by_price_desc"},{title:"Latest publications",indexName:"publications_by_releaseDate_desc"},{title:"Old publications",indexName:"publications_by_releaseDate_asc"}],Transport:[{title:"Relevance",indexName:"publications"},{title:"Low prices publications",indexName:"publications_by_price_asc"},{title:"Highest prices publications",indexName:"publications_by_price_desc"},{title:"Latest publications",indexName:"publications_by_releaseDate_desc"},{title:"Old publications",indexName:"publications_by_releaseDate_asc"}],Services:[{title:"Relevance",indexName:"publications"},{title:"Latest publications",indexName:"publications_by_releaseDate_desc"},{title:"Old publications",indexName:"publications_by_releaseDate_asc"}]}},faceting:{facetsAvailables:{userID:[],categories:[],locations:[],jobType:[],jobRecruiterType:[],jobSalaryType:[],reHomeStatus:[],reHomeFor:[],jobHasBenefits:[],jobHasBonus:[]},currentFacets:{userID:[],categories:[],locations:[],jobType:[],jobRecruiterType:[],jobSalaryType:[],reHomeStatus:[],reHomeFor:[],jobHasBenefits:[],jobHasBonus:[]},treeFacetsMethods:{addFacet:function(e,t){r.algolia.faceting.currentFacets[e]=angular.isDefined(r.algolia.faceting.currentFacets[e])?r.algolia.faceting.currentFacets[e]:[],r.algolia.faceting.currentFacets[e].push(t),r.algolia.req.facetFilters.push(e+":"+t.name),c()},removeAllFacet:function(e){r.algolia.req.page=0,r.algolia.pagination.currentPage=1,angular.copy([],r.algolia.faceting.currentFacets[e]),"categories"===e&&(angular.copy([],r.algolia.faceting.currentFacets.reHomeStatus),angular.copy([],r.algolia.faceting.currentFacets.reHomeFor),angular.copy([],r.algolia.faceting.currentFacets.jobType),angular.copy([],r.algolia.faceting.currentFacets.jobSalaryType),angular.copy([],r.algolia.faceting.currentFacets.jobRecruiterType),angular.copy([],r.algolia.faceting.currentFacets.jobHasBenefits),angular.copy([],r.algolia.faceting.currentFacets.jobHasBonus)),l().then(function(){r.algolia.sortOrder.changeIndexName("publications"),c()})},removeFacet:function(e,t,o){var i=[];angular.copy(r.algolia.faceting.currentFacets[e],i),angular.copy([],r.algolia.faceting.currentFacets[e]);for(var n=0;o>=n;n++)r.algolia.faceting.currentFacets[e].push(i[n]),n===o&&l().then(function(){c()})}},facetsMethods:{addFacet:function(e,t){var o={};o.name=t,r.algolia.faceting.currentFacets[e]=angular.isDefined(r.algolia.faceting.currentFacets[e])?r.algolia.faceting.currentFacets[e]:[],r.algolia.faceting.currentFacets[e].push(o),r.algolia.req.facetFilters.push(e+":"+o.name),c()},removeFacet:function(e){angular.copy([],r.algolia.faceting.currentFacets[e]),l().then(function(){r.algolia.sortOrder.changeIndexName("publications"),c()})}}}},r.submit=function(){f();var e={};"undefined"!=typeof r.account&&(e={},e.name=r.account.user.uid,r.algolia.faceting.currentFacets.userID=[],r.algolia.faceting.currentFacets.userID.push(e),r.algolia.req.facetFilters.push("userID:"+e.name)),"undefined"!=typeof r.profile.$id&&(e={},e.name=r.profile.$id,r.algolia.faceting.currentFacets.userID=[],r.algolia.faceting.currentFacets.userID.push(e),r.algolia.req.facetFilters.push("userID:"+e.name)),c().then(null,function(e){s.error(e)})},e.all(r.lording.promises).then(function(){r.$watch(function(){return r.algolia.req.query},function(){f();var e={};"undefined"!=typeof r.account&&(e={},e.name=r.account.user.uid,r.algolia.faceting.currentFacets.userID=[],r.algolia.faceting.currentFacets.userID.push(e),r.algolia.req.facetFilters.push("userID:"+e.name)),"undefined"!=typeof r.profile.$id&&(e={},e.name=r.profile.$id,r.algolia.faceting.currentFacets.userID=[],r.algolia.faceting.currentFacets.userID.push(e),r.algolia.req.facetFilters.push("userID:"+e.name)),c().then(function(){r.lording.isDone===!1&&(r.lording.deferred.resolve(),r.lording.isDone=!0)},function(e){s.error(e)})})},function(){s.error("This action cannot be completed."),t.path("/")}),r.viewPublication=function(e){t.path("/view-publication/"+e)},r.editPublication=function(e){t.path("/edit-publication/"+e)},r.responsiveFilters=function(e){if(r.algolia.res.nbHits>0){var t=u.open({templateUrl:"responsiveFiltersModal.html",controller:"ResponsiveFiltersController",size:e,resolve:{algolia:function(){return r.algolia}}});t.result.then(function(){},function(e){})}}}}}]).controller("ResponsiveFiltersController",["$scope","$uibModalInstance","algolia",function(e,t,o){e.algolia=o,e.sizeOf=function(e){return"undefined"==typeof e&&(e={}),Object.keys(e).length},e.firstObj=function(e){for(var t in e)if(e.hasOwnProperty(t))return t},e.cancel=function(){t.dismiss()}}]),angular.module("login",["ngMessages","validation.match","trTrustpass","ngPasswordStrength"]).controller("LoginController",["$q","$window","$scope","$location","$uibModal","FireAuth","FireRef","notificationService",function(e,t,o,i,n,a,r,l){function s(){angular.copy(p.recoverAccount,o.model.recoverAccount),o.forms.recoverAccount.$setUntouched(),o.forms.recoverAccount.$setPristine()}function c(e){switch(e.code){case"auth/invalid-email":l.error("The email is invalid.");break;case"auth/user-disabled":l.error("This account has been suspended.");break;case"auth/user-not-found":l.error("There is not user for this email.");break;case"auth/wrong-password":l.error("The password is invalid");break;case"auth/popup-closed-by-user":l.error("The popup has been closed before finalizing the operation.");break;case"auth/network-request-failed":l.error("A network error has occurred.");break;case"auth/account-exists-with-different-credential":f(e.email,e.credential);break;case"auth/email-already-in-use":l.error("The email address is already in use by another account.");break;default:l.error("Undefined Error")}}function u(i){var n=e.defer(),a=r.child("users").child(i.uid),l={};return a.once("value",function(e){var r=null!==e.val();if(r)n.resolve();else{switch(i.providerData[0].providerId){case"facebook.com":l.names=i.providerData[0].displayName,l.provider=i.providerData[0].providerId,l.startedAt=t.firebase.database.ServerValue.TIMESTAMP;break;case"twitter.com":l.names=i.providerData[0].displayName,l.provider=i.providerData[0].providerId,l.startedAt=t.firebase.database.ServerValue.TIMESTAMP;break;case"google.com":l.names=i.providerData[0].displayName,l.provider=i.providerData[0].providerId,l.startedAt=t.firebase.database.ServerValue.TIMESTAMP;break;case"github.com":l.names=i.providerData[0].displayName,l.provider=i.providerData[0].providerId,l.startedAt=t.firebase.database.ServerValue.TIMESTAMP;break;case"password":l.email=o.model.register.email,l.names=o.model.register.names,l.lastNames=o.model.register.lastNames,l.provider=i.providerData[0].providerId,l.startedAt=t.firebase.database.ServerValue.TIMESTAMP}a.set(l,function(e){e?n.reject(e):n.resolve()})}}),n.promise}function d(e,i,a,r){var l=n.open({templateUrl:"promptForLinkCredentialModal.html",controller:"PromptForLinkCredentialController",size:e,resolve:{credential:function(){return a},providers:function(){return r},email:function(){return i}}});l.result.then(function(e){t.sessionStorage.setItem(i+"?provider",e.credential.provider),t.sessionStorage.setItem(i+"?accessToken",e.credential.accessToken),"password"!==e.credential.provider&&o.oauthLogin(e.provider,e.redirect)},function(e){})}function f(e,o){t.firebase.auth().fetchProvidersForEmail(e).then(function(t){d("lg",e,o,t)})}a.$onAuthStateChanged(function(n){if(null!==n){var a=e.defer();o.httpRequestPromise=a.promise;var r,s=[];if(null!==n.email){var c=t.sessionStorage.getItem(n.email+"?provider");if(null!==c){switch(c){case"facebook.com":r=firebase.auth.FacebookAuthProvider.credential(t.sessionStorage.getItem(n.email+"?accessToken"));break;case"google.com":console.log("TODO set credential for: google.com"),l.error("TODO set credential for: google.com");break;case"twitter.com":console.log("TODO set credential for: twitter.com"),l.error("TODO set credential for: twitter.com");break;case"github.com":console.log("TODO set credential for: github.com"),l.error("TODO set credential for: github.com")}"undefined"!=typeof r&&null!==r&&s.push(n.link(r))}}s.push(u(n)),e.all(s).then(function(){"undefined"!=typeof r&&null!==r&&(t.sessionStorage.removeItem(n.email+"?provider"),t.sessionStorage.removeItem(n.email+"?accessToken")),a.resolve(),i.path("/new-publication")})}});var p=angular.copy(o.model={signIn:{email:"",password:"",rememberMe:!1},register:{names:"",lastNames:"",email:"",password:"",samePassword:""},recoverAccount:{email:""}});o.forms={signIn:{},register:{},recoverAccount:{}},o.resetRegisterForm=function(){angular.copy(p.register,o.model.register),o.forms.register.$setUntouched(),o.forms.register.$setPristine()},o.resetSignInForm=function(){angular.copy(p.signIn,o.model.signIn),o.forms.signIn.$setUntouched(),o.forms.signIn.$setPristine()},o.signIn=function(){o.forms.signIn.$setSubmitted(!0),o.forms.signIn.$valid&&(o.httpRequestPromise=a.$signInWithEmailAndPassword(o.model.signIn.email,o.model.signIn.password).then(null,c))},o.recover=function(){o.forms.recoverAccount.$setSubmitted(!0),o.forms.recoverAccount.$valid&&(o.httpRequestPromise=a.$sendPasswordResetEmail(o.model.recoverAccount.email).then(function(){s(),l.success("Password reset email sent successfully!")},function(e){c(e)}))},o.register=function(){o.forms.register.$setSubmitted(!0),o.forms.register.$valid&&(o.httpRequestPromise=a.$createUserWithEmailAndPassword(o.model.register.email,o.model.register.password).then(null,c))},t.firebase.auth().getRedirectResult().then(null,function(e){console.log("error",e),f(e.email,e.credential)}),o.oauthLogin=function(e,i){var n;switch(e){case"facebook.com":n=new t.firebase.auth.FacebookAuthProvider,n.addScope("email");break;case"twitter.com":n=new t.firebase.auth.TwitterAuthProvider;break;case"google.com":n=new firebase.auth.GoogleAuthProvider;break;case"github.com":n=new t.firebase.auth.GithubAuthProvider,n.addScope("user:email")}"undefined"!=typeof i&&i===!0?o.httpRequestPromise=a.$signInWithRedirect(n).then(null,c):o.httpRequestPromise=a.$signInWithPopup(n).then(null,c)}}]).controller("PromptForLinkCredentialController",["$scope","$uibModalInstance","$q","providers","credential",function(e,t,o,i,n){e.providers=i,e.credential=n,e.loginWith=function(e,o){t.close({provider:e,redirect:"undefined"!=typeof o?o:!1,credential:n})},e.cancel=function(){t.dismiss()}}]),$.cloudinary.config().cloud_name="berlin",angular.module("account",["trTrustpass","ngPasswordStrength","cloudinary","algoliasearch","images"]).controller("AccountController",["$scope","$q","user","$uibModal","FireRef","$firebaseObject","notificationService","$log",function(e,t,o,i,n,a,r,l){e.lording={deferred:t.defer(),isDone:!1,promises:[]},e.lording.promise=e.lording.deferred.promise,e.account={user:o,profile:a(n.child("users/"+o.uid)),publications:{},publicationsImages:{}}}]).controller("AccountProfileController",["$scope","$uibModal","notificationService",function(e,t,o){e.lording.promises.push(e.account.profile.$loaded());e.changeProfileDetails=function(i){var n=t.open({templateUrl:"accountProfileDetailsModal.html",controller:"AccountProfileDetailsModalController",size:i,resolve:{profile:function(){return e.account.profile}}});n.result.then(function(){o.success("The profile has been updated.")},function(e){})},e.adminProfileBanners=function(o){var i=t.open({templateUrl:"accountProfileBannersModal.html",controller:"accountProfileBannersModalController",size:o,resolve:{profile:function(){return e.account.profile},user:function(){return e.account.user}}});i.result.then(function(){},function(e){})},e.adminProfileImages=function(o){var i=t.open({templateUrl:"accountProfileImagesModal.html",controller:"accountProfileImagesModalController",size:o,resolve:{profile:function(){return e.account.profile},user:function(){return e.account.user}}});i.result.then(function(){},function(e){})},e.changePassword=function(i){var n=t.open({templateUrl:"accountProfilePasswordModal.html",controller:"AccountProfilePasswordModalController",size:i,resolve:{profile:function(){return e.account.profile}}});n.result.then(function(){o.success("The password has been updated.")},function(e){})},e.changeEmail=function(i){var n=t.open({templateUrl:"accountProfileEmailModal.html",controller:"AccountProfileEmailModalController",size:i,resolve:{profile:function(){return e.account.profile}}});n.result.then(function(){o.success("The email has been updated.")},function(e){})},e.unlinkProvider=function(t){e.httpRequestPromise=e.firebaseUser.unlink(t).then(function(){o.success("The provider has been unlink.")},function(e){o.error(e)})}}]).controller("AccountBillingController",["$scope",function(e){}]).controller("AccountProfileDetailsModalController",["$scope","$uibModalInstance","$q","profile","FireRef",function(e,t,o,i,n){e.forms={profileDetails:{}},e.profile=i,e.model={accountName:angular.isDefined(i.accountName)&&""!==i.accountName?i.accountName:"",pseudonym:angular.isDefined(i.pseudonym)&&""!==i.pseudonym?i.pseudonym:"",bio:angular.isDefined(i.bio)&&""!==i.bio?i.bio:"",names:angular.isDefined(i.names)&&""!==i.names?i.names:"",lastNames:angular.isDefined(i.lastNames)&&""!==i.lastNames?i.lastNames:"",mobilePhone:angular.isDefined(i.mobilePhone)&&""!==i.mobilePhone?i.mobilePhone:"",landLineTelephone:angular.isDefined(i.landLineTelephone)&&""!==i.landLineTelephone?i.landLineTelephone:"",email:angular.isDefined(i.email)&&""!==i.email?i.email:"",twitterAccount:angular.isDefined(i.twitterAccount)&&""!==i.twitterAccount?i.twitterAccount:"",facebookAccount:angular.isDefined(i.facebookAccount)&&""!==i.facebookAccount?i.facebookAccount:""},e.submit=function(){e.forms.profileDetails.$valid&&(angular.forEach(e.model,function(e,t){i[t]=e}),e.httpRequestPromise=o.all([i.$save(),n.child("accountNames").child(e.model.accountName).set(i.$id),n.child("accountNames").child(e.model.accountName.toLowerCase()).set(i.$id)]).then(function(){t.close()},function(e){t.dismiss(e)}))},e.cancel=function(){t.dismiss()}}]).controller("accountProfileImagesModalController",["$scope","$uibModalInstance","$q","imagesService","profile","user","notificationService",function(e,t,o,i,n,a,r){e.forms={profileImages:{}},e.profile=n,e.profile.featuredImageId="undefined"!=typeof e.profile.featuredImageId?e.profile.featuredImageId:"",e.user=a,e.images=[],e.imagesInfo=function(){return i.imagesInfo(e.images)},angular.isDefined(e.profile.images)&&Object.keys(e.profile.images).length>0&&angular.forEach(e.profile.images,function(t,o){t.$id=o,t.$ngfWidth=t.width,t.$ngfHeight=t.height,t.size="undefined"!=typeof t.size?t.size:t.bytes,t.isUploaded=!0,t.name="undefined"!=typeof t.name?t.name:t.original_filename+"."+t.format,e.images.push(t)}),e.submit=function(){e.forms.profileImages.$valid&&(e.httpRequestPromise=i.uploadFiles(e.images,"profile-"+a.uid).then(function(e){return n.images="undefined"!=typeof n.images?n.images:{},angular.forEach(e,function(e,t){n.images[t]=e}),n.$save()}).then(function(){r.success("The file(s) has been uploaded.")},function(e){r.error(e)}))},e.cancel=function(){t.dismiss()}}]).controller("accountProfileBannersModalController",["$scope","$uibModalInstance","$q","imagesService","profile","user","notificationService",function(e,t,o,i,n,a,r){e.forms={profileBanners:{}},e.profile=n,e.profile.featuredBannerId="undefined"!=typeof e.profile.featuredBannerId?e.profile.featuredBannerId:"",e.user=a,e.images=[],e.imagesInfo=function(){return i.imagesInfo(e.images)},angular.isDefined(e.profile.banners)&&Object.keys(e.profile.banners).length>0&&angular.forEach(e.profile.banners,function(t,o){t.$id=o,t.$ngfWidth=t.width,t.$ngfHeight=t.height,t.size="undefined"!=typeof t.size?t.size:t.bytes,t.isUploaded=!0,t.name="undefined"!=typeof t.name?t.name:t.original_filename+"."+t.format,e.images.push(t)}),e.submit=function(){e.forms.profileBanners.$valid&&(e.httpRequestPromise=i.uploadFiles(e.images,"profile-banners-"+a.uid).then(function(e){return n.banners="undefined"!=typeof n.banners?n.banners:{},angular.forEach(e,function(e,t){n.banners[t]=e}),n.$save()}).then(function(){r.success("The file(s) has been uploaded.")},function(e){r.error(e)}))},e.cancel=function(){t.dismiss()}}]).controller("AccountProfilePasswordModalController",["$scope","$uibModalInstance","FireAuth","profile",function(e,t,o,i){e.forms={accountPassword:{}};angular.copy(e.model={accountPassword:{oldPassword:"",newPassword:"",sameNewPassword:""}});e.submit=function(){e.forms.accountPassword.$valid&&(e.httpRequestPromise=o.$changePassword({email:i.email,oldPassword:e.model.accountPassword.oldPassword,newPassword:e.model.accountPassword.newPassword}).then(function(){t.close()},function(e){t.dismiss(e)}))},e.cancel=function(){t.dismiss()}}]).controller("AccountProfileEmailModalController",["$q","$scope","$uibModalInstance","FireAuth","profile",function(e,t,o,i,n){t.forms={emailAccount:{}};var a=angular.copy(t.model={emailAccount:{newEmail:"",password:""}});t.submit=function(){if(t.forms.emailAccount.$valid){var a=e.defer();t.httpRequestPromise=a.promise,i.$changeEmail({password:t.model.emailAccount.password,newEmail:t.model.emailAccount.newEmail,oldEmail:n.email}).then(function(){return n.email=t.model.emailAccount.newEmail,
n.$save()}).then(function(){o.close(),a.resolve()},function(e){o.dismiss(e),a.reject(e)})}},t.resetForm=function(){angular.copy(a.emailAccount,t.model.emailAccount),t.forms.emailAccount.$setUntouched(),t.forms.emailAccount.$setPristine()},t.cancel=function(){o.dismiss()}}]).directive("isAccountNameAvailable",["FireRef","$q",function(e,t){return{require:"ngModel",scope:{profile:"=profile"},link:function(o,i,n,a){a.$asyncValidators.isAccountNameAvailable=function(i,n){var a=t.defer(),r=i||n;return t.all([e.child("accountNames").child(r).once("value"),e.child("users").child(o.profile.$id).child("accountName").once("value")]).then(function(e){e[0].exists()?e[0].val()===o.profile.$id?a.resolve(!0):a.reject(!1):a.resolve(!0)},function(){a.reject(!1)}),a.promise}}}}]);var publicationsModule=angular.module("accountPublications",["algoliasearch"]).controller("AccountPublicationsController",["$scope","$timeout","$q","$uibModal","$routeParams","$location","FireRef","$firebaseObject",function(e,t,o,i,n,a,r,l){function s(){function t(t){e.profile=l(r.child("users").child(t)),e.profile.$banners=[],e.profile.$images=[]}var i=o.defer();return r.child("accountNames").child(n.accountName).once("value").then(function(o){return o.exists()?(t(o.val()),e.profile.$loaded()):(t(n.accountName),e.profile.$loaded())}).then(function(){"undefined"!=typeof e.profile.startedAt?(e.profile.$seoURL="https://londres.herokuapp.com/",e.profile.$seoURL+=void 0!==e.profile.accountName&&""!==e.profile.accountName?e.profile.accountName:e.profile.$id,i.resolve()):i.reject()}),i.promise}function c(){var t=[];angular.forEach(e.profile.banners,function(o,i){o.$id=i,i!==e.profile.featuredBannerId?t.push(o):t.unshift(o)}),e.profile.$banners=t}function u(){var t=[];angular.forEach(e.profile.images,function(o,i){o.$id=i,i!==e.profile.featuredImageId?t.push(o):t.unshift(o)}),e.profile.$images=t}e.profile={},e.publications={more:!1,count:0,countDifference:0,lastCount:0,setCount:function(t,o){e.publications.count=t,o&&(e.publications.lastCount=t)}},e.lording={deferred:o.defer(),isDone:!1,promises:[]},e.lording.promise=e.lording.deferred.promise;var d=s().then(function(){var o=!0;e.$watch(function(){return e.profile.publicationsCount},function(i,n){i>n&&o&&(o=!1,t(function(){o=!0,e.publications.countDifference=e.profile.publicationsCount-e.publications.lastCount,e.publications.setCount(e.profile.publicationsCount),e.publications.more=!0},1e4))}),e.$watch(function(){return e.profile.images},function(){u()}),e.$watch(function(){return e.profile.banners},function(){c()})},function(){a.path("/")});e.lording.promises.push(d),e.profileImages=function(t,o){if(angular.isDefined(e.profile.$images)&&e.profile.$images.length>0){var n=i.open({templateUrl:"profileImagesModal.html",controller:"ProfileImagesController",size:t,resolve:{profileImages:function(){return e.profile.$images},active:function(){return o}}});n.result.then(function(){},function(e){})}}}]).controller("ProfileImagesController",["$scope","$uibModalInstance","profileImages","active",function(e,t,o,i){e.profileImages=o,e.active="undefined"!=typeof i?i:0,e.cancel=function(){t.dismiss()}}]);